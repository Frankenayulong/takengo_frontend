"use strict";var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){function i(t,i,n){var o=n.baseHref(),a=t[0];return function(t,n,r){var s,h;h=(r=r||{}).expires,s=e.isDefined(r.path)?r.path:o,e.isUndefined(n)&&(h="Thu, 01 Jan 1970 00:00:00 GMT",n=""),e.isString(h)&&(h=new Date(h)),n=(n=encodeURIComponent(t)+"="+encodeURIComponent(n))+(s?";path="+s:"")+(r.domain?";domain="+r.domain:""),n+=h?";expires="+h.toUTCString():"",4096<(r=(n+=r.secure?";secure":"").length+1)&&i.warn("Cookie '"+t+"' possibly not set or overflowed because it was too large ("+r+" > 4096 bytes)!"),a.cookie=n}}e.module("ngCookies",["ng"]).info({angularVersion:"1.6.4"}).provider("$cookies",[function(){var t=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(i,n){return{get:function(t){return i()[t]},getObject:function(t){return(t=this.get(t))?e.fromJson(t):t},getAll:function(){return i()},put:function(i,o,a){n(i,o,a?e.extend({},t,a):t)},putObject:function(t,i,n){this.put(t,e.toJson(i),n)},remove:function(i,o){n(i,void 0,o?e.extend({},t,o):t)}}}]}]),e.module("ngCookies").factory("$cookieStore",["$cookies",function(t){return{get:function(e){return t.getObject(e)},put:function(e,i){t.putObject(e,i)},remove:function(e){t.remove(e)}}}]),i.$inject=["$document","$log","$browser"],e.module("ngCookies").provider("$$cookieWriter",function(){this.$get=i})}(window,window.angular),function(t){var e=function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e,i,n){if(!(e>=1)){for(var o=Math.max(n.width,Math.min(i.width,Math.round(t.width*e))),a=Math.max(n.height,Math.min(i.height,Math.round(t.height*e))),r=t.width,s=t.height,h=t,l=void 0;r>o&&s>a;)l=document.createElement("canvas"),r=Math.round(.5*h.width),s=Math.round(.5*h.height),r<o&&(r=o),s<a&&(s=a),l.width=r,l.height=s,l.getContext("2d").drawImage(h,0,0,r,s),h=rt(l);t.width=o,t.height=a,t.getContext("2d").drawImage(h,0,0,o,a)}}!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}if("function"==typeof window.CustomEvent)return!1;t.prototype=window.Event.prototype,window.CustomEvent=t}();var i=function t(e,i,n){var o,a,r=document.createElement("img");if(r.onerror=i,r.onload=function(){!a||n&&n.noRevoke||t.revokeObjectURL(a),i&&i(t.scale(r,n))},t.isInstanceOf("Blob",e)||t.isInstanceOf("File",e))o=a=t.createObjectURL(e),r._type=e.type;else{if("string"!=typeof e)return!1;o=e,n&&n.crossOrigin&&(r.crossOrigin=n.crossOrigin)}return o?(r.src=o,r):t.readFile(e,function(t){var e=t.target;e&&e.result?r.src=e.result:i&&i(t)})},n=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;i.isInstanceOf=function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},i.transformCoordinates=function(){},i.getTransformedOptions=function(t,e){var i,n,o,a,r=e.aspectRatio;if(!r)return e;i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i.crop=!0,o=t.naturalWidth||t.width,a=t.naturalHeight||t.height,o/a>r?(i.maxWidth=a*r,i.maxHeight=a):(i.maxWidth=o,i.maxHeight=o/r),i},i.renderImageToCanvas=function(t,e,i,n,o,a,r,s,h,l){return t.getContext("2d").drawImage(e,i,n,o,a,r,s,h,l),t},i.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},i.scale=function(t,e){function n(){var t=Math.max((s||w)/w,(h||b)/b);t>1&&(w*=t,b*=t)}function o(){var t=Math.min((a||w)/w,(r||b)/b);t<1&&(w*=t,b*=t)}e=e||{};var a,r,s,h,l,u,c,p,d,f,_,m=document.createElement("canvas"),g=t.getContext||i.hasCanvasOption(e)&&m.getContext,v=t.naturalWidth||t.width,y=t.naturalHeight||t.height,w=v,b=y;if(g&&(c=(e=i.getTransformedOptions(t,e)).left||0,p=e.top||0,e.sourceWidth?(l=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(c=v-l-e.right)):l=v-c-(e.right||0),e.sourceHeight?(u=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(p=y-u-e.bottom)):u=y-p-(e.bottom||0),w=l,b=u),a=e.maxWidth,r=e.maxHeight,s=e.minWidth,h=e.minHeight,g&&a&&r&&e.crop?(w=a,b=r,(_=l/u-a/r)<0?(u=r*l/a,void 0===e.top&&void 0===e.bottom&&(p=(y-u)/2)):_>0&&(l=a*u/r,void 0===e.left&&void 0===e.right&&(c=(v-l)/2))):((e.contain||e.cover)&&(s=a=a||s,h=r=r||h),e.cover?(o(),n()):(n(),o())),g){if((d=e.pixelRatio)>1&&(m.style.width=w+"px",m.style.height=b+"px",w*=d,b*=d,m.getContext("2d").scale(d,d)),(f=e.downsamplingRatio)>0&&f<1&&w<l&&b<u)for(;l*f>w;)m.width=l*f,m.height=u*f,i.renderImageToCanvas(m,t,c,p,l,u,0,0,m.width,m.height),l=m.width,u=m.height,(t=document.createElement("canvas")).width=l,t.height=u,i.renderImageToCanvas(t,m,0,0,l,u,0,0,l,u);return m.width=w,m.height=b,i.transformCoordinates(m,e),i.renderImageToCanvas(m,t,c,p,l,u,0,0,w,b)}return t.width=w,t.height=b,t},i.createObjectURL=function(t){return!!n&&n.createObjectURL(t)},i.revokeObjectURL=function(t){return!!n&&n.revokeObjectURL(t)},i.readFile=function(t,e,i){if(window.FileReader){var n=new FileReader;if(n.onload=n.onerror=e,i=i||"readAsDataURL",n[i])return n[i](t),n}return!1};var o=i.hasCanvasOption,a=i.transformCoordinates,r=i.getTransformedOptions;i.hasCanvasOption=function(t){return!!t.orientation||o.call(i,t)},i.transformCoordinates=function(t,e){a.call(i,t,e);var n=t.getContext("2d"),o=t.width,r=t.height,s=t.style.width,h=t.style.height,l=e.orientation;if(l&&!(l>8))switch(l>4&&(t.width=r,t.height=o,t.style.width=h,t.style.height=s),l){case 2:n.translate(o,0),n.scale(-1,1);break;case 3:n.translate(o,r),n.rotate(Math.PI);break;case 4:n.translate(0,r),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-r);break;case 7:n.rotate(.5*Math.PI),n.translate(o,-r),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-o,0)}},i.getTransformedOptions=function(t,e){var n,o,a=r.call(i,t,e),s=a.orientation;if(!s||s>8||1===s)return a;n={};for(o in a)a.hasOwnProperty(o)&&(n[o]=a[o]);switch(a.orientation){case 2:n.left=a.right,n.right=a.left;break;case 3:n.left=a.right,n.top=a.bottom,n.right=a.left,n.bottom=a.top;break;case 4:n.top=a.bottom,n.bottom=a.top;break;case 5:n.left=a.top,n.top=a.left,n.right=a.bottom,n.bottom=a.right;break;case 6:n.left=a.top,n.top=a.right,n.right=a.bottom,n.bottom=a.left;break;case 7:n.left=a.bottom,n.top=a.right,n.right=a.top,n.bottom=a.left;break;case 8:n.left=a.bottom,n.top=a.left,n.right=a.top,n.bottom=a.right}return a.orientation>4&&(n.maxWidth=a.maxHeight,n.maxHeight=a.maxWidth,n.minWidth=a.minHeight,n.minHeight=a.minWidth,n.sourceWidth=a.sourceHeight,n.sourceHeight=a.sourceWidth),n};var s=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);i.blobSlice=s&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},i.metaDataParsers={jpeg:{65505:[]}},i.parseMetaData=function(t,e,n){var o=this,a=(n=n||{}).maxMetaDataSize||262144,r={};!!(window.DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&i.blobSlice)&&i.readFile(i.blobSlice.call(t,0,a),function(t){if(t.target.error)e(r);else{var a,s,h,l,u=t.target.result,c=new DataView(u),p=2,d=c.byteLength-4,f=p;if(65496===c.getUint16(0)){for(;p<d&&((a=c.getUint16(p))>=65504&&a<=65519||65534===a)&&(s=c.getUint16(p+2)+2,!(p+s>c.byteLength));){if(h=i.metaDataParsers.jpeg[a])for(l=0;l<h.length;l+=1)h[l].call(o,c,p,s,r,n);f=p+=s}!n.disableImageHead&&f>6&&(u.slice?r.imageHead=u.slice(0,f):r.imageHead=new Uint8Array(u).subarray(0,f))}e(r)}},"readAsArrayBuffer")||e(r)},(i.ExifMap=function(){return this}).prototype.map={Orientation:274},i.ExifMap.prototype.get=function(t){return this[t]||this[this.map[t]]},i.getExifThumbnail=function(t,e,i){var n,o,a;if(i&&!(e+i>t.byteLength)){for(n=[],o=0;o<i;o+=1)a=t.getUint8(e+o),n.push((a<16?"0":"")+a.toString(16));return"data:image/jpeg,%"+n.join("%")}},(i.exifTagTypes={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,i){return t.getUint16(e,i)},size:2},4:{getValue:function(t,e,i){return t.getUint32(e,i)},size:4},5:{getValue:function(t,e,i){return t.getUint32(e,i)/t.getUint32(e+4,i)},size:8},9:{getValue:function(t,e,i){return t.getInt32(e,i)},size:4},10:{getValue:function(t,e,i){return t.getInt32(e,i)/t.getInt32(e+4,i)},size:8}})[7]=i.exifTagTypes[1],i.getExifValue=function(t,e,n,o,a,r){var s,h,l,u,c,p,d=i.exifTagTypes[o];if(d&&(s=d.size*a,!((h=s>4?e+t.getUint32(n+8,r):n+8)+s>t.byteLength))){if(1===a)return d.getValue(t,h,r);for(l=[],u=0;u<a;u+=1)l[u]=d.getValue(t,h+u*d.size,r);if(d.ascii){for(c="",u=0;u<l.length&&"\0"!==(p=l[u]);u+=1)c+=p;return c}return l}},i.parseExifTag=function(t,e,n,o,a){var r=t.getUint16(n,o);a.exif[r]=i.getExifValue(t,e,n,t.getUint16(n+2,o),t.getUint32(n+4,o),o)},i.parseExifTags=function(t,e,i,n,o){var a,r,s;if(!(i+6>t.byteLength||(a=t.getUint16(i,n),(r=i+2+12*a)+4>t.byteLength))){for(s=0;s<a;s+=1)this.parseExifTag(t,e,i+2+12*s,n,o);return t.getUint32(r,n)}},i.parseExifData=function(t,e,n,o,a){if(!a.disableExif){var r,s,h,l=e+10;if(1165519206===t.getUint32(e+4)&&!(l+8>t.byteLength)&&0===t.getUint16(e+8)){switch(t.getUint16(l)){case 18761:r=!0;break;case 19789:r=!1;break;default:return}42===t.getUint16(l+2,r)&&(s=t.getUint32(l+4,r),o.exif=new i.ExifMap,(s=i.parseExifTags(t,l,l+s,r,o))&&!a.disableExifThumbnail&&(h={exif:{}},s=i.parseExifTags(t,l,l+s,r,h),h.exif[513]&&(o.exif.Thumbnail=i.getExifThumbnail(t,l+h.exif[513],h.exif[514]))),o.exif[34665]&&!a.disableExifSub&&i.parseExifTags(t,l,l+o.exif[34665],r,o),o.exif[34853]&&!a.disableExifGps&&i.parseExifTags(t,l,l+o.exif[34853],r,o))}}},i.metaDataParsers.jpeg[65505].push(i.parseExifData);var h=function(){var t=[],e=[],i=[],n="transform",o=window.getComputedStyle(document.documentElement,"");"webkit"===(Array.prototype.slice.call(o).join("").match(/-(moz|webkit|ms)-/)||""===o.OLink&&["","o"])[1]&&(n="webkitTransform");var a=function(t,e,i){var n=t;if(void 0!==n.length){for(var o={chainers:[],then:function(t){return this.snabbt(t)},snabbt:function(t){var e=this.chainers.length;return this.chainers.forEach(function(i,n){i.snabbt(r(t,n,e))}),o},setValue:function(t){return this.chainers.forEach(function(e){e.setValue(t)}),o},finish:function(){return this.chainers.forEach(function(t){t.finish()}),o},rollback:function(){return this.chainers.forEach(function(t){t.rollback()}),o}},a=0,h=n.length;a<h;++a)"string"==typeof e?o.chainers.push(s(n[a],e,r(i,a,h))):o.chainers.push(s(n[a],r(e,a,h),i));return o}return"string"==typeof e?s(n,e,r(i,0,1)):s(n,r(e,0,1),i)},r=function(t,e,i){if(!t)return t;var n=j(t);W(t.delay)&&(n.delay=t.delay(e,i)),W(t.callback)&&(n.complete=function(){t.callback.call(this,e,i)});var o=W(t.allDone),a=W(t.complete);return(a||o)&&(n.complete=function(){a&&t.complete.call(this,e,i),o&&e==i-1&&t.allDone()}),W(t.valueFeeder)&&(n.valueFeeder=function(n,o){return t.valueFeeder(n,o,e,i)}),W(t.easing)&&(n.easing=function(n){return t.easing(n,e,i)}),["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"].forEach(function(o){W(t[o])&&(n[o]=t[o](e,i))}),n},s=function(t,i,n){function o(i){if(_.tick(i),_.updateElement(t),!_.isStopped())return _.completed()?void(a.loop>1&&!_.isStopped()?(a.loop-=1,_.restart(),w(o)):(a.complete&&a.complete.call(t),y.length&&(a=y.pop(),u=g(a,p,!0),p=g(a,j(p)),a=v(u,p,a),_=k(a),e.push([t,_]),_.tick(i),w(o)))):w(o)}if("attention"===i)return h(t,n);if("stop"===i)return l(t);if("detach"===i)return c(t);var a=i;f();var s=m(t),u=s;u=g(a,u,!0);var p=j(s);p=g(a,p);var d=v(u,p,a),_=k(d);e.push([t,_]),_.updateElement(t,!0);var y=[],b={snabbt:function(t){return y.unshift(r(t,0,1)),b},then:function(t){return this.snabbt(t)}};return w(o),a.manual?_:b},h=function(t,i){function n(e){a.tick(e),a.updateElement(t),a.completed()?(i.callback&&i.callback(t),i.loop&&i.loop>1&&(i.loop--,a.restart(),w(n))):w(n)}var o=g(i,N({}));i.movement=o;var a=C(i);e.push([t,a]),w(n)},l=function(t){for(var i=0,n=e.length;i<n;++i){var o=e[i],a=o[0],r=o[1];a===t&&r.stop()}},u=function(t,e){for(var i=0,n=t.length;i<n;++i)if(t[i][0]===e)return i;return-1},c=function(t){var n,o,a=[],r=e.concat(i),s=r.length;for(o=0;o<s;++o)n=r[o][0],(t.contains(n)||t===n)&&a.push(n);for(s=a.length,o=0;o<s;++o)p(a[o])},p=function(t){l(t);var n=u(e,t);n>=0&&e.splice(n,1),(n=u(i,t))>=0&&i.splice(n,1)},d=function(t,e){for(var i=0,n=t.length;i<n;++i){var o=t[i],a=o[0],r=o[1];if(a===e){var s=r.getCurrentState();return r.stop(),s}}},f=function(){i=i.filter(function(t){return _(t[0]).body})},_=function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e},m=function(t){var n=d(e,t);return n||d(i,t)},g=function(t,e,i){e||(e=N({position:[0,0,0],rotation:[0,0,0],rotationPost:[0,0,0],scale:[1,1],skew:[0,0]}));var n="position",o="rotation",a="skew",r="rotationPost",s="scale",h="scalePost",l="width",u="height",c="opacity";return i&&(n="fromPosition",o="fromRotation",a="fromSkew",r="fromRotationPost",s="fromScale",h="fromScalePost",l="fromWidth",u="fromHeight",c="fromOpacity"),e.position=B(t[n],e.position),e.rotation=B(t[o],e.rotation),e.rotationPost=B(t[r],e.rotationPost),e.skew=B(t[a],e.skew),e.scale=B(t[s],e.scale),e.scalePost=B(t[h],e.scalePost),e.opacity=t[c],e.width=t[l],e.height=t[u],e},v=function(t,e,i){return i.startState=t,i.endState=e,i},y=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},w=function(e){0===t.length&&y(b),t.push(e)},b=function n(o){for(var a=t.length,r=0;r<a;++r)t[r](o);t.splice(0,a);var s=e.filter(function(t){return t[1].completed()});i=i.filter(function(t){for(var e=0,i=s.length;e<i;++e)if(t[0]===s[e][0])return!1;return!0}),i=i.concat(s),e=e.filter(function(t){return!t[1].completed()}),0!==t.length&&y(n)},k=function(t){var e=t.startState,i=t.endState,n=B(t.duration,500),o=B(t.delay,0),a=t.perspective,r=E(B(t.easing,"linear"),t),s=0===n?i.clone():e.clone();t.transformOrigin;s.transformOrigin=t.transformOrigin;var h,l,u=0,c=0,p=!1,d=!1,f=t.manual,_=0,m=o/n;return l=t.valueFeeder?H(t.valueFeeder,e,i,s):U(e,i,s),{stop:function(){p=!0},isStopped:function(){return p},finish:function(t){f=!1,u=c-n*_,h=t,r.resetFrom=_},rollback:function(t){f=!1,l.setReverse(),u=c-n*(1-_),h=t,r.resetFrom=_},restart:function(){u=void 0,r.resetFrom(0)},tick:function(t){if(!p){if(f)return c=t,void this.updateCurrentTransform();if(u||(u=t),t-u>o){d=!0,c=t-o;var e=Math.min(Math.max(0,c-u),n);r.tick(e/n),this.updateCurrentTransform(),this.completed()&&h&&h()}}},getCurrentState:function(){return s},setValue:function(t){d=!0,_=Math.min(Math.max(t,1e-4),1+m)},updateCurrentTransform:function(){var t=r.getValue();if(f){var e=Math.max(1e-5,_-m);r.tick(e),t=r.getValue()}l.tween(t)},completed:function(){return!!p||0!==u&&r.completed()},updateElement:function(t,e){if(d||e){var i=l.asMatrix(),n=l.getProperties();F(t,i,a),$(t,n)}}}},C=function(t){var e=t.movement;t.initialVelocity=.1,t.equilibriumPosition=0;var i=x(t),n=!1,o=e.position,a=e.rotation,r=e.rotationPost,s=e.scale,h=e.skew,l=N({position:o?[0,0,0]:void 0,rotation:a?[0,0,0]:void 0,rotationPost:r?[0,0,0]:void 0,scale:s?[0,0]:void 0,skew:h?[0,0]:void 0});return{stop:function(){n=!0},isStopped:function(t){return n},tick:function(t){n||i.equilibrium||(i.tick(),this.updateMovement())},updateMovement:function(){var t=i.getValue();o&&(l.position[0]=e.position[0]*t,l.position[1]=e.position[1]*t,l.position[2]=e.position[2]*t),a&&(l.rotation[0]=e.rotation[0]*t,l.rotation[1]=e.rotation[1]*t,l.rotation[2]=e.rotation[2]*t),r&&(l.rotationPost[0]=e.rotationPost[0]*t,l.rotationPost[1]=e.rotationPost[1]*t,l.rotationPost[2]=e.rotationPost[2]*t),s&&(l.scale[0]=1+e.scale[0]*t,l.scale[1]=1+e.scale[1]*t),h&&(l.skew[0]=e.skew[0]*t,l.skew[1]=e.skew[1]*t)},updateElement:function(t){F(t,l.asMatrix()),$(t,l.getProperties())},getCurrentState:function(){return l},completed:function(){return i.equilibrium||n},restart:function(){i=x(t)}}},x=function(t){var e=B(t.startPosition,0),i=B(t.equilibriumPosition,1),n=B(t.initialVelocity,0),o=B(t.springConstant,.8),a=B(t.springDeceleration,.9),r=B(t.springMass,10),s=!1;return{tick:function(t){0!==t&&(s||(e+=n+=-(e-i)*o/r,n*=a,Math.abs(e-i)<.001&&Math.abs(n)<.001&&(s=!0)))},resetFrom:function(t){e=t,n=0},getValue:function(){return s?i:e},completed:function(){return s}}},S={linear:function(t){return t},ease:function(t){return(Math.cos(t*Math.PI+Math.PI)+1)/2},easeIn:function(t){return t*t},easeOut:function(t){return 1-Math.pow(t-1,2)}},E=function(t,e){if("spring"==t)return x(e);var i=t;W(t)||(i=S[t]);var n,o=i,a=0;return{tick:function(t){a=o(t),n=t},resetFrom:function(t){n=0},getValue:function(){return a},completed:function(){return n>=1&&n}}},T=function(t,e,i,n){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e,t[13]=i,t[14]=n,t[15]=1},I=function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=Math.cos(e),t[6]=-Math.sin(e),t[7]=0,t[8]=0,t[9]=Math.sin(e),t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},P=function(t,e){t[0]=Math.cos(e),t[1]=0,t[2]=Math.sin(e),t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=-Math.sin(e),t[9]=0,t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},M=function(t,e){t[0]=Math.cos(e),t[1]=-Math.sin(e),t[2]=0,t[3]=0,t[4]=Math.sin(e),t[5]=Math.cos(e),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},R=function(t,e,i){t[0]=1,t[1]=Math.tan(e),t[2]=0,t[3]=0,t[4]=Math.tan(i),t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},L=function(t,e,i){t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},O=function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},D=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},A=function(){var t=new Float32Array(16),e=new Float32Array(16),i=new Float32Array(16);return O(t),{data:t,asCSS:function(){for(var e="matrix3d(",i=0;i<15;++i)Math.abs(t[i])<1e-4?e+="0,":e+=t[i].toFixed(10)+",";return Math.abs(t[15])<1e-4?e+="0)":e+=t[15].toFixed(10)+")",e},clear:function(){O(t)},translate:function(n,o,a){return D(t,e),T(i,n,o,a),z(e,i,t),this},rotateX:function(n){return D(t,e),I(i,n),z(e,i,t),this},rotateY:function(n){return D(t,e),P(i,n),z(e,i,t),this},rotateZ:function(n){return D(t,e),M(i,n),z(e,i,t),this},scale:function(n,o){return D(t,e),L(i,n,o),z(e,i,t),this},skew:function(n,o){return D(t,e),R(i,n,o),z(e,i,t),this}}},z=function(t,e,i){return i[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],i[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],i[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],i[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],i[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],i[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],i[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],i[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],i[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],i[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],i[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],i[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],i[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],i[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],i[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],i},N=function t(e){var i=A(),n={opacity:void 0,width:void 0,height:void 0};return{position:e.position,rotation:e.rotation,rotationPost:e.rotationPost,skew:e.skew,scale:e.scale,scalePost:e.scalePost,opacity:e.opacity,width:e.width,height:e.height,clone:function(){return t({position:this.position?this.position.slice(0):void 0,rotation:this.rotation?this.rotation.slice(0):void 0,rotationPost:this.rotationPost?this.rotationPost.slice(0):void 0,skew:this.skew?this.skew.slice(0):void 0,scale:this.scale?this.scale.slice(0):void 0,scalePost:this.scalePost?this.scalePost.slice(0):void 0,height:this.height,width:this.width,opacity:this.opacity})},asMatrix:function(){var t=i;return t.clear(),this.transformOrigin&&t.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),this.scale&&t.scale(this.scale[0],this.scale[1]),this.skew&&t.skew(this.skew[0],this.skew[1]),this.rotation&&(t.rotateX(this.rotation[0]),t.rotateY(this.rotation[1]),t.rotateZ(this.rotation[2])),this.position&&t.translate(this.position[0],this.position[1],this.position[2]),this.rotationPost&&(t.rotateX(this.rotationPost[0]),t.rotateY(this.rotationPost[1]),t.rotateZ(this.rotationPost[2])),this.scalePost&&t.scale(this.scalePost[0],this.scalePost[1]),this.transformOrigin&&t.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),t},getProperties:function(){return n.opacity=this.opacity,n.width=this.width+"px",n.height=this.height+"px",n}}},U=function(t,e,i){var n=t,o=e,a=i,r=void 0!==o.position,s=void 0!==o.rotation,h=void 0!==o.rotationPost,l=void 0!==o.scale,u=void 0!==o.skew,c=void 0!==o.width,p=void 0!==o.height,d=void 0!==o.opacity;return{tween:function(t){if(r){var e=o.position[0]-n.position[0],i=o.position[1]-n.position[1],f=o.position[2]-n.position[2];a.position[0]=n.position[0]+t*e,a.position[1]=n.position[1]+t*i,a.position[2]=n.position[2]+t*f}if(s){var _=o.rotation[0]-n.rotation[0],m=o.rotation[1]-n.rotation[1],g=o.rotation[2]-n.rotation[2];a.rotation[0]=n.rotation[0]+t*_,a.rotation[1]=n.rotation[1]+t*m,a.rotation[2]=n.rotation[2]+t*g}if(h){var v=o.rotationPost[0]-n.rotationPost[0],y=o.rotationPost[1]-n.rotationPost[1],w=o.rotationPost[2]-n.rotationPost[2];a.rotationPost[0]=n.rotationPost[0]+t*v,a.rotationPost[1]=n.rotationPost[1]+t*y,a.rotationPost[2]=n.rotationPost[2]+t*w}if(u){var b=o.scale[0]-n.scale[0],k=o.scale[1]-n.scale[1];a.scale[0]=n.scale[0]+t*b,a.scale[1]=n.scale[1]+t*k}if(l){var C=o.skew[0]-n.skew[0],x=o.skew[1]-n.skew[1];a.skew[0]=n.skew[0]+t*C,a.skew[1]=n.skew[1]+t*x}if(c){var S=o.width-n.width;a.width=n.width+t*S}if(p){var E=o.height-n.height;a.height=n.height+t*E}if(d){var T=o.opacity-n.opacity;a.opacity=n.opacity+t*T}},asMatrix:function(){return a.asMatrix()},getProperties:function(){return a.getProperties()},setReverse:function(){var t=n;n=o,o=t}}},H=function(t,e,i,n){var o=t(0,A()),a=e,r=i,s=n,h=!1;return{tween:function(e){h&&(e=1-e),o.clear(),o=t(e,o);var i=r.width-a.width,n=r.height-a.height,l=r.opacity-a.opacity;void 0!==r.width&&(s.width=a.width+e*i),void 0!==r.height&&(s.height=a.height+e*n),void 0!==r.opacity&&(s.opacity=a.opacity+e*l)},asMatrix:function(){return o},getProperties:function(){return s.getProperties()},setReverse:function(){h=!0}}},B=function(t,e){return void 0===t?e:t},F=function(t,e,i){var o="";i&&(o="perspective("+i+"px) ");var a=e.asCSS();t.style[n]=o+a},$=function(t,e){for(var i in e)t.style[i]=e[i]},W=function(t){return"function"==typeof t},j=function(t){if(!t)return t;var e={};for(var i in t)e[i]=t[i];return e};return a.createMatrix=A,a.setElementTransform=F,a}(),l=function(){function t(t,e,i,n,o){if("string"==typeof t)t=document.getElementById(t);else if(!t instanceof HTMLCanvasElement)return;var a,r=t.getContext("2d");try{try{a=r.getImageData(e,i,n,o)}catch(t){throw new Error("unable to access local image data: "+t)}}catch(t){throw new Error("unable to access image data: "+t)}return a}function e(t,e,a,r,s,h){var l,u,c,p,d,f,_,m,g,v,y,w,b,k,C,x,S,E,T,I,P,M,R,L,O=t.data,D=h+h+1,A=r-1,z=s-1,N=h+1,U=N*(N+1)/2,H=new i,B=H;for(c=1;c<D;c++)if(B=B.next=new i,c==N)var F=B;B.next=H;var $=null,W=null;_=f=0;var j=n[h],q=o[h];for(u=0;u<s;u++){for(x=S=E=T=m=g=v=y=0,w=N*(I=O[f]),b=N*(P=O[f+1]),k=N*(M=O[f+2]),C=N*(R=O[f+3]),m+=U*I,g+=U*P,v+=U*M,y+=U*R,B=H,c=0;c<N;c++)B.r=I,B.g=P,B.b=M,B.a=R,B=B.next;for(c=1;c<N;c++)p=f+((A<c?A:c)<<2),m+=(B.r=I=O[p])*(L=N-c),g+=(B.g=P=O[p+1])*L,v+=(B.b=M=O[p+2])*L,y+=(B.a=R=O[p+3])*L,x+=I,S+=P,E+=M,T+=R,B=B.next;for($=H,W=F,l=0;l<r;l++)O[f+3]=R=y*j>>q,0!=R?(R=255/R,O[f]=(m*j>>q)*R,O[f+1]=(g*j>>q)*R,O[f+2]=(v*j>>q)*R):O[f]=O[f+1]=O[f+2]=0,m-=w,g-=b,v-=k,y-=C,w-=$.r,b-=$.g,k-=$.b,C-=$.a,p=_+((p=l+h+1)<A?p:A)<<2,m+=x+=$.r=O[p],g+=S+=$.g=O[p+1],v+=E+=$.b=O[p+2],y+=T+=$.a=O[p+3],$=$.next,w+=I=W.r,b+=P=W.g,k+=M=W.b,C+=R=W.a,x-=I,S-=P,E-=M,T-=R,W=W.next,f+=4;_+=r}for(l=0;l<r;l++){for(S=E=T=x=g=v=y=m=0,w=N*(I=O[f=l<<2]),b=N*(P=O[f+1]),k=N*(M=O[f+2]),C=N*(R=O[f+3]),m+=U*I,g+=U*P,v+=U*M,y+=U*R,B=H,c=0;c<N;c++)B.r=I,B.g=P,B.b=M,B.a=R,B=B.next;for(d=r,c=1;c<=h;c++)f=d+l<<2,m+=(B.r=I=O[f])*(L=N-c),g+=(B.g=P=O[f+1])*L,v+=(B.b=M=O[f+2])*L,y+=(B.a=R=O[f+3])*L,x+=I,S+=P,E+=M,T+=R,B=B.next,c<z&&(d+=r);for(f=l,$=H,W=F,u=0;u<s;u++)O[(p=f<<2)+3]=R=y*j>>q,R>0?(R=255/R,O[p]=(m*j>>q)*R,O[p+1]=(g*j>>q)*R,O[p+2]=(v*j>>q)*R):O[p]=O[p+1]=O[p+2]=0,m-=w,g-=b,v-=k,y-=C,w-=$.r,b-=$.g,k-=$.b,C-=$.a,p=l+((p=u+N)<z?p:z)*r<<2,m+=x+=$.r=O[p],g+=S+=$.g=O[p+1],v+=E+=$.b=O[p+2],y+=T+=$.a=O[p+3],$=$.next,w+=I=W.r,b+=P=W.g,k+=M=W.b,C+=R=W.a,x-=I,S-=P,E-=M,T-=R,W=W.next,f+=r}return t}function i(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(i,n,o,a,r,s){if(!(isNaN(s)||s<1)){s|=0;var h=t(i,n,o,a,r);h=e(h,0,0,a,r,s),i.getContext("2d").putImageData(h,n,o)}}}();HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),o=n.length,a=new Uint8Array(o),r=0;r<o;r++)a[r]=n.charCodeAt(r);t(new Blob([a],{type:e||"image/png"}))}});var u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return void 0===t?"undefined":_typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":_typeof2(t)},p=function(t){if(void 0===t.dataset){var e,i={},n=t.attributes;for(e in n)n.hasOwnProperty(e)&&n[e].name&&/^data-[a-z_\-\d]*$/i.test(n[e].name)&&(i[d(n[e].name.substr(5))]=n[e].value);return i}return t.dataset},d=function(t){return t.replace(/\-./g,function(t){return t.charAt(1).toUpperCase()})},f=function(t){for(var e=[],i=Array.prototype.slice.call(t.attributes),n=i.length,o=0;o<n;o++)e.push({name:i[o].name,value:i[o].value});return e},_=function(t){return{x:void 0===t.offsetX?t.layerX:t.offsetX,y:void 0===t.offsetY?t.layerY:t.offsetY}},m=function(t,e){var i,n={},o=e||{};for(i in t)t.hasOwnProperty(i)&&(n[i]=void 0===o[i]?t[i]:o[i]);return n},g={ESC:27,RETURN:13},v={DOWN:["touchstart","pointerdown","mousedown"],MOVE:["touchmove","pointermove","mousemove"],UP:["touchend","touchcancel","pointerup","mouseup"]},y={jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp"},w=/(\.png|\.bmp|\.gif|\.jpg|\.jpe|\.jpg|\.jpeg)$/,b=function(t,e){var i=document.createElement(t);return e&&(i.className=e),i},k=function(t,e,i){e.forEach(function(e){t.addEventListener(e,i,!1)})},C=function(t,e,i){e.forEach(function(e){t.removeEventListener(e,i,!1)})},x=function(t){var e=t.changedTouches?t.changedTouches[0]:t;if(e)return{x:e.pageX,y:e.pageY}},S=function(t,e){var i=Math.PI/180*e,n=Math.cos(i),o=Math.sin(i),a=t.x,r=t.y,s=t.x+t.width,h=t.y+t.height,l=n*(a-.5)+o*(r-.5)+.5,u=n*(r-.5)-o*(a-.5)+.5,c=n*(s-.5)+o*(h-.5)+.5,p=n*(h-.5)-o*(s-.5)+.5;l<=c?(t.x=l,t.width=c-l):(t.x=c,t.width=l-c),u<=p?(t.y=u,t.height=p-u):(t.y=p,t.height=u-p)},E=function(t){var e=x(t);return e.x-=window.pageXOffset||document.documentElement.scrollLeft,e.y-=window.pageYOffset||document.documentElement.scrollTop,e},T=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},I=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},P=function(t){return t[t.length-1]},M=function(t,e,i){return Math.max(e,Math.min(i,t))},R=function(t,e){if(!e)return!1;for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1},L=function(t,e,i,n,o,a){var r=new XMLHttpRequest;n&&r.upload.addEventListener("progress",function(t){n(t.loaded,t.total)}),r.open("POST",t,!0),i&&i(r),r.onreadystatechange=function(){if(4===r.readyState&&r.status>=200&&r.status<300){var t=r.responseText;if(!t.length)return void o();if(-1!==t.indexOf("Content-Length"))return void a("file-too-big");var e=void 0;try{e=JSON.parse(r.responseText)}catch(t){}if("object"===(void 0===e?"undefined":c(e))&&"failure"===e.status)return void a(e.message);o(e||t)}else if(4===r.readyState){var i=void 0;try{i=JSON.parse(r.responseText)}catch(t){}if("object"===(void 0===i?"undefined":c(i))&&"failure"===i.status)return void a(i.message);a("fail")}},r.send(e)},O=function(t){t&&(t.style.webkitTransform="",t.style.transform="")},D=function(t){return t/1e6},A=function(){var t=[],e=void 0,i=void 0;for(e in y)y.hasOwnProperty(e)&&(i=y[e],-1==t.indexOf(i)&&t.push(i));return t},z=function(t){return"image/jpeg"===t},N=function(t){var e=void 0;for(e in y)if(y.hasOwnProperty(e)&&y[e]===t)return e;return t},U=function(t){var e=void 0;for(e in y)if(y.hasOwnProperty(e)&&-1!==t.indexOf(y[e]))return y[e];return null},H=function(t){return t.split("/").pop().split("?").shift()},B=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},F=function(t){return t.getFullYear()+"-"+B(t.getMonth()+1,"00")+"-"+B(t.getDate(),"00")+"_"+B(t.getHours(),"00")+"-"+B(t.getMinutes(),"00")+"-"+B(t.getSeconds(),"00")},$=function(t){return void 0===t.name?F(new Date)+"."+N(W(t)):t.name},W=function(t){return t.type||"image/jpeg"},j=function(t){return"string"!=typeof t?F(new Date):H(t).split(".").shift()},q=function(t,e){return"lastModified"in File.prototype?t.lastModified=new Date:t.lastModifiedDate=new Date,t.name=e,t},G=function(t){return/^data:image/.test(t)},V=function(t,e,i,n){t=t+(-1!==t.indexOf("?")?"&":"?")+"url="+e;var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="json",o.onload=function(){"failure"!==this.response.status?X(this.response.body,n):i(this.response.message)},o.send()},X=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(i){var n=H(t),o=U(this.response.type);w.test(n)||(n+="."+N(o));var a=q(this.response,n);e(mt(a,o))},i.send()},Y=function(t){var e=t.split(",")[1].replace(/\s/g,"");return atob(e)},K=function(t,e){for(var i=Y(t),n=new ArrayBuffer(i.length),o=new Uint8Array(n),a=0;a<i.length;a++)o[a]=i.charCodeAt(a);var r=yt(t);return void 0===e&&(e=F(new Date)+"."+N(r)),q(J(n,r),e)},J=function(t,e){var i=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(i){var n=new i;return n.append(t),n.getBlob(e)}return new Blob([t],{type:e})},Z=function(t,e,n){var o="string"!=typeof t||0!==t.indexOf("data:image");i.parseMetaData(t,function(a){var r={canvas:!0,crossOrigin:o};e&&(r.maxWidth=e.width,r.maxHeight=e.height),a.exif&&(r.orientation=a.exif.get("Orientation")),i(t,function(t){"error"!==t.type?n(t,a):n()},r)})},Q=function(t,e,i){var n,o,a,r;return e/t<i?(n=.5*(t-(a=(r=e)/i)),o=0):(n=0,o=.5*(e-(r=(a=t)*i))),{x:n,y:o,height:r,width:a}},tt=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],o=b("canvas"),a=i.rotation,r=i.crop,s=i.size,h=i.filters,l=i.minSize;if(r){var u=a%180!=0,c={width:u?t.height:t.width,height:u?t.width:t.height};r.x<0&&(r.x=0),r.y<0&&(r.y=0),r.width>c.width&&(r.width=c.width),r.height>c.height&&(r.height=c.height),r.y+r.height>c.height&&(r.y=Math.max(0,c.height-r.height)),r.x+r.width>c.width&&(r.x=Math.max(0,c.width-r.width));var p=r.x/c.width,d=r.y/c.height,f=r.width/c.width,_=r.height/c.height;o.width=r.width,o.height=r.height;var m=o.getContext("2d");90===a?(m.translate(.5*o.width,.5*o.height),m.rotate(-90*Math.PI/180),m.drawImage(t,(1-d)*t.width-t.width*_,r.x,r.height,r.width,.5*-o.height,.5*-o.width,o.height,o.width)):180===a?(m.translate(.5*o.width,.5*o.height),m.rotate(-180*Math.PI/180),m.drawImage(t,(1-(p+f))*c.width,(1-(d+_))*c.height,f*c.width,_*c.height,.5*-o.width,.5*-o.height,o.width,o.height)):270===a?(m.translate(.5*o.width,.5*o.height),m.rotate(-270*Math.PI/180),m.drawImage(t,r.y,(1-p)*t.height-t.height*f,r.height,r.width,.5*-o.height,.5*-o.width,o.height,o.width)):m.drawImage(t,r.x,r.y,r.width,r.height,0,0,o.width,o.height)}if(s){var g=s.width/o.width,v=s.height/o.height;e(o,Math.min(g,v),s,l),h.sharpen>0&&it(o,ot(h.sharpen))}n(o)},et=function(t){return t.getContext("2d").getImageData(0,0,t.width,t.height)},it=function(t,e){t.getContext("2d").putImageData(e(et(t),t.width,t.height),0,0)},nt=function(t,e,i){var n=document.createElement("canvas");n.width=t,n.height=e;var o=n.getContext("2d").createImageData(n.width,n.height);return i&&o.set(i.data),o},ot=function(t){return function(e,i,n){for(var o=[0,-1,0,-1,5,-1,0,-1,0],a=Math.round(Math.sqrt(o.length)),r=.5*a|0,s=nt(i,n),h=s.data,l=e.data,u=n,c=void 0;u--;)for(c=i;c--;){for(var p=u,d=c,f=4*(u*i+c),_=0,m=0,g=0,v=0;v<a;v++)for(var y=0;y<a;y++){var w=p+v-r,b=d+y-r;if(w>=0&&w<n&&b>=0&&b<i){var k=4*(w*i+b),C=o[v*a+y];_+=l[k]*C,m+=l[k+1]*C,g+=l[k+2]*C,l[k+3]*C}}h[f]=_*t+l[f]*(1-t),h[f+1]=m*t+l[f+1]*(1-t),h[f+2]=g*t+l[f+2]*(1-t),h[f+3]=l[f+3]}return s}},at=function(t,e){var i=Math.abs(t.width-e.width),n=Math.abs(t.height-e.height);return Math.max(i,n)},rt=function(t){return st(t,1)},st=function(t,i){if(!t)return null;var n=document.createElement("canvas"),o=n.getContext("2d");return n.width=t.width,n.height=t.height,o.drawImage(t,0,0),i>0&&1!=i&&e(n,i,{width:Math.round(t.width*i),height:Math.round(t.height*i)},{width:0,height:0}),n},ht=function(t){return t.width&&t.height},lt=function(t,e){var i=e.getContext("2d");ht(e)?i.drawImage(t,0,0,e.width,e.height):(e.width=t.width,e.height=t.height,i.drawImage(t,0,0))},ut=function(t){l(t,0,0,t.width,t.height,3)},ct=function(t,e){return parseInt(t.width,10)>=e.width&&parseInt(t.height,10)>=e.height},pt=function(t,e,i){return{x:t.x*e,y:t.y*i,width:t.width*e,height:t.height*i}},dt=function(t,e,i){return{x:t.x/e,y:t.y/i,width:t.width/e,height:t.height/i}},ft=function(t){if(t&&""!==t.value){try{t.value=""}catch(t){}if(t.value){var e=document.createElement("form"),i=t.parentNode,n=t.nextSibling;e.appendChild(t),e.reset(),n?i.insertBefore(t,n):i.appendChild(t)}}},_t=function(t){return"object"===("undefined"==typeof value?"undefined":c(value))&&null!==value?JSON.parse(JSON.stringify(t)):t},mt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t)return null;var i=t.slice(0,t.size,e||t.type);return i.name=t.name,"lastModified"in File.prototype&&t.lastModified?i.lastModified=new Date(t.lastModified):t.lastModifiedDate&&(i.lastModifiedDate=new Date(t.lastModifiedDate)),i},gt=function(t){var e=_t(t);return e.input.file=mt(t.input.file),e.output.image=rt(t.output.image),e},vt=function(t,e,i){return t&&e?t.toDataURL(e,z(e)&&"number"==typeof i?i/100:void 0):null},yt=function(t){if(!t)return null;var e=t.substr(0,16).match(/^.+;/);return e.length?e[0].substring(5,e[0].length-1):null},wt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments[2],n=arguments[3],o=arguments[4],a={server:_t(t.server),meta:_t(t.meta),input:{name:t.input.name,type:t.input.type,size:t.input.size,width:t.input.width,height:t.input.height,field:t.input.field}};return R("input",e)&&!o&&(a.input.image=vt(t.input.image,t.input.type)),R("output",e)&&(a.output={name:n?j(t.input.name)+"."+n:t.input.name,type:y[n]||t.input.type,width:t.output.width,height:t.output.height},a.output.image=vt(t.output.image,a.output.type,i),a.output.type=yt(a.output.image),"image/png"===a.output.type&&(a.output.name=j(a.input.name)+".png")),R("actions",e)&&(a.actions=_t(t.actions)),a},bt=function(t,e,i){var n=t.output.image,o=i?j(t.input.name)+"."+i:t.input.name,a=y[i]||t.input.type;"image/png"===a&&(o=j(t.input.name)+".png"),n.toBlob(function(t){if("msSaveBlob"in window.navigator)window.navigator.msSaveBlob(t,o);else{var e=(window.URL||window.webkitURL).createObjectURL(t),i=b("a");i.style.display="none",i.download=o,i.href=e,document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),(window.URL||window.webkitURL).revokeObjectURL(e)},0)}},a,"number"==typeof e?e/100:void 0)},kt=function(t,e,i){var n=i.querySelector(t);n&&(n.style.display=e?"":"none")},Ct=function(t){return Array.prototype.slice.call(t)},xt=function(t){t.parentNode.removeChild(t)},St=function(t){var e=b("div");return t.parentNode&&(t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)),e.appendChild(t),e},Et=function(t,e,i,n){var o=(n-90)*Math.PI/180;return{x:t+i*Math.cos(o),y:e+i*Math.sin(o)}},Tt=function(t,e,i,n,o){var a=Et(t,e,i,o),r=Et(t,e,i,n),s=o-n<=180?"0":"1";return["M",a.x,a.y,"A",i,i,0,s,0,r.x,r.y].join(" ")},It=function(t,e,i,n){return Tt(t,e,i,0,360*n)},Pt=function(){var e={n:function(t,e,i,n){var o,a,r,s,h,l,u;return r=t.y+t.height,o=M(e.y,0,r),r-o<i.min.height&&(o=r-i.min.height),(h=n?(r-o)/n:t.width)<i.min.width&&(o=r-(h=i.min.width)*n),l=.5*(h-t.width),s=t.x-l,a=t.x+t.width+l,(s<0||a>i.width)&&(u=Math.min(t.x,i.width-(t.x+t.width)),s=t.x-u,o=r-(h=(a=t.x+t.width+u)-s)*n),{x:s,y:o,width:a-s,height:r-o}},s:function(t,e,i,n){var o,a,r,s,h,l,u;return o=t.y,(r=M(e.y,o,i.height))-o<i.min.height&&(r=o+i.min.height),(h=n?(r-o)/n:t.width)<i.min.width&&(r=o+(h=i.min.width)*n),l=.5*(h-t.width),s=t.x-l,a=t.x+t.width+l,(s<0||a>i.width)&&(u=Math.min(t.x,i.width-(t.x+t.width)),s=t.x-u,r=o+(h=(a=t.x+t.width+u)-s)*n),{x:s,y:o,width:a-s,height:r-o}},e:function(t,e,i,n){var o,a,r,s,h,l,u;return s=t.x,(a=M(e.x,s,i.width))-s<i.min.width&&(a=s+i.min.width),(h=n?(a-s)*n:t.height)<i.min.height&&(a=s+(h=i.min.height)/n),l=.5*(h-t.height),o=t.y-l,r=t.y+t.height+l,(o<0||r>i.height)&&(u=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-u,a=s+(h=(r=t.y+t.height+u)-o)/n),{x:s,y:o,width:a-s,height:r-o}},w:function(t,e,i,n){var o,a,r,s,h,l,u,c;return a=t.x+t.width,s=M(e.x,0,a),a-s<i.min.width&&(s=a-i.min.width),(l=n?(a-s)*n:t.height)<i.min.height&&(s=a-(l=i.min.height)/n),u=.5*(l-t.height),o=t.y-u,r=t.y+t.height+u,(o<0||r>i.height)&&(c=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-c,h=(l=(r=t.y+t.height+c)-o)/n,s=a-h),{x:s,y:o,width:a-s,height:r-o}},ne:function(t,e,i,n){var o,a,r,s,h,l;return s=t.x,r=t.y+t.height,(a=M(e.x,s,i.width))-s<i.min.width&&(a=s+i.min.width),(h=n?(a-s)*n:M(r-e.y,i.min.height,r))<i.min.height&&(a=s+(h=i.min.height)/n),((o=t.y-(h-t.height))<0||r>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),a=s+(h=r-(o=t.y-l))/n),{x:s,y:o,width:a-s,height:r-o}},se:function(t,e,i,n){var o,a,r,s,h,l;return s=t.x,o=t.y,(a=M(e.x,s,i.width))-s<i.min.width&&(a=s+i.min.width),(h=n?(a-s)*n:M(e.y-t.y,i.min.height,i.height-o))<i.min.height&&(a=s+(h=i.min.height)/n),r=t.y+t.height+(h-t.height),(o<0||r>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),a=s+(h=(r=t.y+t.height+l)-o)/n),{x:s,y:o,width:a-s,height:r-o}},sw:function(t,e,i,n){var o,a,r,s,h,l;return a=t.x+t.width,o=t.y,s=M(e.x,0,a),a-s<i.min.width&&(s=a-i.min.width),(h=n?(a-s)*n:M(e.y-t.y,i.min.height,i.height-o))<i.min.height&&(s=a-(h=i.min.height)/n),r=t.y+t.height+(h-t.height),(o<0||r>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),s=a-(h=(r=t.y+t.height+l)-o)/n),{x:s,y:o,width:a-s,height:r-o}},nw:function(t,e,i,n){var o,a,r,s,h,l;return a=t.x+t.width,r=t.y+t.height,s=M(e.x,0,a),a-s<i.min.width&&(s=a-i.min.width),(h=n?(a-s)*n:M(r-e.y,i.min.height,r))<i.min.height&&(s=a-(h=i.min.height)/n),((o=t.y-(h-t.height))<0||r>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),s=a-(h=r-(o=t.y-l))/n),{x:s,y:o,width:a-s,height:r-o}}};return function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("div");t(this,i),this._element=e,this._interaction=null,this._minWidth=0,this._minHeight=0,this._ratio=null,this._rect={x:0,y:0,width:0,height:0},this._space={width:0,height:0},this._rectChanged=!1,this._init()}return u(i,[{key:"_init",value:function(){this._element.className="slim-crop-area";var t=b("div","grid");this._element.appendChild(t);for(var i in e)if(e.hasOwnProperty(i)){var n=b("button",i);this._element.appendChild(n)}var o=b("button","c");this._element.appendChild(o),k(document,v.DOWN,this)}},{key:"reset",value:function(){this._interaction=null,this._rect={x:0,y:0,width:0,height:0},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"rescale",value:function(t){1!==t&&(this._interaction=null,this._rectChanged=!0,this._rect.x*=t,this._rect.y*=t,this._rect.width*=t,this._rect.height*=t,this._redraw(),this._element.dispatchEvent(new CustomEvent("change")))}},{key:"limit",value:function(t,e){this._space.width=t,this._space.height=e}},{key:"offset",value:function(t,e){this._space.x=t,this._space.y=e}},{key:"resize",value:function(t,e,i,n){this._interaction=null,this._rect={x:M(t,0,this._space.width-this._minWidth),y:M(e,0,this._space.height-this._minHeight),width:M(i,this._minWidth,this._space.width),height:M(n,this._minHeight,this._space.height)},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"mousedown":this._onStartDrag(t);break;case"touchmove":case"pointermove":case"mousemove":this._onDrag(t);break;case"touchend":case"touchcancel":case"pointerup":case"mouseup":this._onStopDrag(t)}}},{key:"_onStartDrag",value:function(t){this._element.contains(t.target)&&(t.preventDefault(),k(document,v.MOVE,this),k(document,v.UP,this),this._interaction={type:t.target.className,offset:E(t)},this._interaction.offset.x-=this._rect.x,this._interaction.offset.y-=this._rect.y,this._element.setAttribute("data-dragging","true"),this._redraw())}},{key:"_onDrag",value:function(t){t.preventDefault();var i=E(t),n=this._interaction.type;"c"===n?(this._rect.x=M(i.x-this._interaction.offset.x,0,this._space.width-this._rect.width),this._rect.y=M(i.y-this._interaction.offset.y,0,this._space.height-this._rect.height)):e[n]&&(this._rect=e[n](this._rect,{x:i.x-this._space.x,y:i.y-this._space.y},{x:0,y:0,width:this._space.width,height:this._space.height,min:{width:this._minWidth,height:this._minHeight}},this._ratio)),this._rectChanged=!0,this._element.dispatchEvent(new CustomEvent("input"))}},{key:"_onStopDrag",value:function(t){t.preventDefault(),C(document,v.MOVE,this),C(document,v.UP,this),this._interaction=null,this._element.setAttribute("data-dragging","false"),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"_redraw",value:function(){var t=this;if(this._rectChanged){var e="translate("+this._rect.x+"px,"+this._rect.y+"px);";this._element.style.cssText="\n\t\t\t\t\t-webkit-transform: "+e+";\n\t\t\t\t\ttransform: "+e+";\n\t\t\t\t\twidth:"+this._rect.width+"px;\n\t\t\t\t\theight:"+this._rect.height+"px;\n\t\t\t\t",this._rectChanged=!1}this._interaction&&requestAnimationFrame(function(){return t._redraw()})}},{key:"destroy",value:function(){this._interaction=!1,this._rectChanged=!1,C(document,v.DOWN,this),C(document,v.MOVE,this),C(document,v.UP,this),xt(this._element)}},{key:"element",get:function(){return this._element}},{key:"space",get:function(){return this._space}},{key:"area",get:function(){return{x:this._rect.x/this._space.width,y:this._rect.y/this._space.height,width:this._rect.width/this._space.width,height:this._rect.height/this._space.height}}},{key:"dirty",get:function(){return 0!==this._rect.x||0!==this._rect.y||0!==this._rect.width||0!==this._rect.height}},{key:"minWidth",set:function(t){this._minWidth=t}},{key:"minHeight",set:function(t){this._minHeight=t}},{key:"ratio",set:function(t){this._ratio=t}}]),i}()}(),Mt=function(){var e=["input","change"],i=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("div"),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,i),this._element=e,this._options=m(i.options(),n),this._ratio=null,this._output=null,this._input=null,this._preview=null,this._previewBlurred=null,this._blurredPreview=!1,this._cropper=null,this._straightCrop=null,this._previewWrapper=null,this._currentWindowSize={},this._btnGroup=null,this._maskFrame=null,this._dirty=!1,this._wrapperRotation=0,this._wrapperScale=1,this._init()}return u(i,[{key:"_init",value:function(){var t=this;this._element.className="slim-image-editor",this._container=b("div","slim-container"),this._wrapper=b("div","slim-wrapper"),this._stage=b("div","slim-stage"),this._container.appendChild(this._stage),this._cropper=new Pt,e.forEach(function(e){t._cropper.element.addEventListener(e,t)}),this._stage.appendChild(this._cropper.element),this._previewWrapper=b("div","slim-image-editor-preview slim-crop-preview"),this._previewBlurred=b("canvas","slim-crop-blur"),this._previewWrapper.appendChild(this._previewBlurred),this._wrapper.appendChild(this._previewWrapper),this._previewMask=b("div","slim-crop-mask"),this._preview=b("img"),this._previewMask.appendChild(this._preview),this._cropper.element.appendChild(this._previewMask),this._btnGroup=b("div","slim-editor-btn-group"),i.Buttons.forEach(function(e){var i=I(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"],a=t._options["button"+i+"ClassName"],r=b("button","slim-editor-btn slim-btn-"+e+(a?" "+a:""));r.innerHTML=n,r.title=o||n,r.type="button",r.setAttribute("data-action",e),r.addEventListener("click",t),t._btnGroup.appendChild(r)}),this._utilsGroup=b("div","slim-editor-utils-group");var n=b("button","slim-editor-utils-btn slim-btn-rotate"+(this._options.buttonRotateClassName?" "+this._options.buttonRotateClassName:""));n.setAttribute("data-action","rotate"),n.addEventListener("click",this),n.title=this._options.buttonRotateTitle,this._utilsGroup.appendChild(n),this._container.appendChild(this._wrapper),this._element.appendChild(this._container),this._element.appendChild(this._utilsGroup),this._element.appendChild(this._btnGroup)}},{key:"dirty",value:function(){this._dirty=!0}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onGridChange(t);break;case"input":this._onGridInput(t);break;case"keydown":this._onKeyDown(t);break;case"resize":this._onResize(t)}}},{key:"_onKeyDown",value:function(t){switch(t.keyCode){case g.RETURN:this._confirm();break;case g.ESC:this._cancel()}}},{key:"_onClick",value:function(t){t.target.classList.contains("slim-btn-cancel")&&this._cancel(),t.target.classList.contains("slim-btn-confirm")&&this._confirm(),t.target.classList.contains("slim-btn-rotate")&&this._rotate()}},{key:"_onResize",value:function(){this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._redraw(),this._redrawCropper(this._cropper.area),this._updateWrapperScale(),this._redrawWrapper()}},{key:"_redrawWrapper",value:function(){var t=h.createMatrix();t.scale(this._wrapperScale,this._wrapperScale),t.rotateZ(this._wrapperRotation*(Math.PI/180)),h.setElementTransform(this._previewWrapper,t)}},{key:"_onGridInput",value:function(){this._redrawCropMask()}},{key:"_onGridChange",value:function(){this._redrawCropMask()}},{key:"_updateWrapperRotation",value:function(){this._options.minSize.width>this._input.height||this._options.minSize.height>this._input.width?this._wrapperRotation+=180:this._wrapperRotation+=90}},{key:"_updateWrapperScale",value:function(){if(this._wrapperRotation%180!=0){var t=this._container.offsetWidth,e=this._container.offsetHeight,i=this._wrapper.offsetHeight,n=this._wrapper.offsetWidth,o=t/i;o*n>e&&(o=e/n),this._wrapperScale=o}else this._wrapperScale=1}},{key:"_cancel",value:function(){this._element.dispatchEvent(new CustomEvent("cancel"))}},{key:"_confirm",value:function(){var t=this._wrapperRotation%180!=0,e=this._cropper.area,i=pt(e,t?this._input.height:this._input.width,t?this._input.width:this._input.height);this._element.dispatchEvent(new CustomEvent("confirm",{detail:{rotation:this._wrapperRotation%360,crop:i}}))}},{key:"_rotate",value:function(){var t=this;this._updateWrapperRotation();var e=1===this.ratio||null===this._ratio?this._cropper.area:null;e&&S(e,90),this._updateWrapperScale(),this._hideCropper(),h(this._previewWrapper,{rotation:[0,0,this._wrapperRotation*(Math.PI/180)],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.8,springDeceleration:.65,complete:function(){t._redrawCropper(e),t._showCropper()}})}},{key:"_showCropper",value:function(){h(this._stage,{easing:"ease",duration:250,fromOpacity:0,opacity:1})}},{key:"_hideCropper",value:function(){h(this._stage,{duration:0,fromOpacity:0,opacity:0})}},{key:"_redrawCropMask",value:function(){var t=this,e=this._wrapperRotation%360,i=this._wrapperScale,n={width:this._wrapper.offsetWidth,height:this._wrapper.offsetHeight},o=this._cropper.area,a={x:0,y:0};0===e?(a.x=-o.x,a.y=-o.y):90===e?(a.x=-(1-o.y),a.y=-o.x):180===e?(a.x=-(1-o.x),a.y=-(1-o.y)):270===e&&(a.x=-o.y,a.y=-(1-o.x)),a.x*=n.width,a.y*=n.height,cancelAnimationFrame(this._maskFrame),this._maskFrame=requestAnimationFrame(function(){var n="scale("+i+") rotate("+-e+"deg) translate("+a.x+"px, "+a.y+"px);";t._preview.style.cssText="\n\t\t\t\t\twidth: "+t._previewSize.width+"px;\n\t\t\t\t\theight: "+t._previewSize.height+"px;\n\t\t\t\t\t-webkit-transform: "+n+";\n\t\t\t\t\ttransform: "+n+";\n\t\t\t\t"})}},{key:"open",value:function(t,e,i,n,o){var a=this;if(!this._input||this._dirty||this._ratio!==e){this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._dirty=!1,this._wrapperRotation=n||0,this._blurredPreview=!1,this._ratio=e,this._previewSize=null,this._element.style.opacity="0",this._input=t;var r=n%180!=0,s=dt(i,r?t.height:t.width,r?t.width:t.height);this._preview.onload=function(){a._preview.onload=null,a._cropper.ratio=a.ratio,a._redraw(),a._redrawCropper(s),o(),a._element.style.opacity=""},this._preview.src=st(this._input,Math.min(this._container.offsetWidth/this._input.width,this._container.offsetHeight/this._input.height)).toDataURL()}else o()}},{key:"_redrawCropper",value:function(t){var e=this._wrapperRotation%180!=0,i=e?this._input.height/this._input.width:this._input.width/this._input.height,n=this._wrapper.offsetWidth,o=this._wrapper.offsetHeight,a=this._container.offsetWidth,r=this._container.offsetHeight;this._updateWrapperScale();var s=this._wrapperScale*(e?o:n),h=this._wrapperScale*(e?n:o),l=e?.5*(a-s):this._wrapper.offsetLeft,u=e?.5*(r-h):this._wrapper.offsetTop;this._stage.style.cssText="\n\t\t\t\tleft:"+l+"px;\n\t\t\t\ttop:"+u+"px;\n\t\t\t\twidth:"+s+"px;\n\t\t\t\theight:"+h+"px;\n\t\t\t",this._cropper.limit(s,s/i),this._cropper.offset(l+this._element.offsetLeft,u+this._element.offsetTop),this._cropper.minWidth=this._wrapperScale*this._options.minSize.width*this.scalar,this._cropper.minHeight=this._wrapperScale*this._options.minSize.height*this.scalar;var c=null;c=t?{x:t.x*s,y:t.y*h,width:t.width*s,height:t.height*h}:Q(s,h,this._ratio||h/s),this._cropper.resize(c.x,c.y,c.width,c.height)}},{key:"_redraw",value:function(){var t=this._input.height/this._input.width,e=this._container.clientWidth,i=this._container.clientHeight,n=e,o=n*t;o>i&&(n=(o=i)/t);var a=(e-(n=Math.round(n)))/2,r=(i-(o=Math.round(o)))/2;this._wrapper.style.cssText="\n\t\t\t\tleft:"+a+"px;\n\t\t\t\ttop:"+r+"px;\n\t\t\t\twidth:"+n+"px;\n\t\t\t\theight:"+o+"px;\n\t\t\t",this._previewBlurred.style.cssText="\n\t\t\t\twidth:"+n+"px;\n\t\t\t\theight:"+o+"px;\n\t\t\t",this._preview.style.cssText="\n\t\t\t\twidth:"+n+"px;\n\t\t\t\theight:"+o+"px;\n\t\t\t",this._previewSize={width:n,height:o},this._blurredPreview||(this._previewBlurred.width=300,this._previewBlurred.height=this._previewBlurred.width*t,lt(this._input,this._previewBlurred),ut(this._previewBlurred),this._blurredPreview=!0)}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._currentWindowSize.width===window.innerWidth&&this._currentWindowSize.height===window.innerHeight||(this._redraw(),this._redrawCropper(this._cropper.area)),document.addEventListener("keydown",this),window.addEventListener("resize",this);var e=this._wrapperRotation*(Math.PI/180);h(this._previewWrapper,{fromRotation:[0,0,e],rotation:[0,0,e],fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,fromScale:[this._wrapperScale-.02,this._wrapperScale-.02],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.3,springDeceleration:.85,delay:450,complete:function(){}}),this._cropper.dirty?h(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:850,complete:function(){O(this),t()}}):h(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:1e3,complete:function(){O(this)}}),h(this._btnGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,delay:function(t){return 1e3+100*t},easing:"spring",springConstant:.3,springDeceleration:.85,complete:function(){O(this)}}),h(this._utilsGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.85,delay:1250,complete:function(){O(this)}})}},{key:"hide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};document.removeEventListener("keydown",this),window.removeEventListener("resize",this),h(this._utilsGroup.childNodes,{fromOpacity:1,opacity:0,duration:250}),h(this._btnGroup.childNodes,{fromOpacity:1,opacity:0,delay:200,duration:350}),h([this._stage,this._previewWrapper],{fromPosition:[0,0,0],position:[0,-250,0],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,delay:250,allDone:function(){t()}})}},{key:"destroy",value:function(){var t=this;Ct(this._btnGroup.children).forEach(function(e){e.removeEventListener("click",t)}),e.forEach(function(e){t._cropper.element.removeEventListener(e,t)}),this._cropper.destroy(),this._element.parentNode&&xt(this._element)}},{key:"showRotateButton",set:function(t){t?this._element.classList.remove("slim-rotation-disabled"):this._element.classList.add("slim-rotation-disabled")}},{key:"element",get:function(){return this._element}},{key:"ratio",get:function(){return"input"===this._ratio?this._input.height/this._input.width:this._ratio}},{key:"offset",get:function(){return this._element.getBoundingClientRect()}},{key:"original",get:function(){return this._input}},{key:"scalar",get:function(){return this._previewSize.width/this._input.width}}],[{key:"options",value:function(){return{buttonCancelClassName:null,buttonConfirmClassName:null,buttonCancelLabel:"Cancel",buttonConfirmLabel:"Confirm",buttonCancelTitle:null,buttonConfirmTitle:null,buttonRotateTitle:"Rotate",buttonRotateClassName:null,minSize:{width:0,height:0}}}}]),i}();return i.Buttons=["cancel","confirm"],i}(),Rt=function(){var e=["dragenter","dragover","dragleave","drop"];return function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("div");t(this,i),this._element=e,this._accept=[],this._allowURLs=!1,this._dragPath=null,this._init()}return u(i,[{key:"isValidDataTransfer",value:function(t){return t.files&&t.files.length?this.areValidDataTransferFiles(t.files):t.items&&t.items.length?this.areValidDataTransferItems(t.items):null}},{key:"areValidDataTransferFiles",value:function(t){return!this._accept.length||!t||-1!==this._accept.indexOf(t[0].type)}},{key:"areValidDataTransferItems",value:function(t){return!this._accept.length||!t||(this._allowURLs&&"string"===t[0].kind?null:t[0].type&&0===t[0].type.indexOf("application")?null:-1!==this._accept.indexOf(t[0].type))}},{key:"reset",value:function(){this._element.files=null}},{key:"_init",value:function(){var t=this;this._element.className="slim-file-hopper",e.forEach(function(e){t._element.addEventListener(e,t)})}},{key:"handleEvent",value:function(t){switch(t.type){case"dragenter":case"dragover":this._onDragOver(t);break;case"dragleave":this._onDragLeave(t);break;case"drop":this._onDrop(t)}}},{key:"_onDrop",value:function(t){t.preventDefault();var e=null;if(this._allowURLs){var i=void 0,n=void 0;try{i=t.dataTransfer.getData("url"),n=t.dataTransfer.getData("text/html")}catch(t){}if(n&&n.length){var o=n.match(/src\s*=\s*"(.+?)"/);o&&(e=o[1])}else i&&i.length&&(e=i)}if(e)this._element.files=[{remote:e}];else{if(!this.isValidDataTransfer(t.dataTransfer))return this._element.dispatchEvent(new CustomEvent("file-invalid-drop")),void(this._dragPath=null);this._element.files=t.dataTransfer.files}this._element.dispatchEvent(new CustomEvent("file-drop",{detail:_(t)})),this._element.dispatchEvent(new CustomEvent("change")),this._dragPath=null}},{key:"_onDragOver",value:function(t){t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=this.isValidDataTransfer(t.dataTransfer);if(null!==e&&!e)return t.dataTransfer.dropEffect="none",void this._element.dispatchEvent(new CustomEvent("file-invalid"));this._dragPath||(this._dragPath=[]),this._dragPath.push(_(t)),this._element.dispatchEvent(new CustomEvent("file-over",{detail:{x:P(this._dragPath).x,y:P(this._dragPath).y}}))}},{key:"_onDragLeave",value:function(t){this._element.dispatchEvent(new CustomEvent("file-out",{detail:_(t)})),this._dragPath=null}},{key:"destroy",value:function(){var t=this;e.forEach(function(e){t._element.removeEventListener(e,t)}),xt(this._element),this._element=null,this._dragPath=null,this._accept=null}},{key:"element",get:function(){return this._element}},{key:"dragPath",get:function(){return this._dragPath}},{key:"enabled",get:function(){return""===this._element.style.display},set:function(t){this._element.style.display=t?"":"none"}},{key:"allowURLs",set:function(t){this._allowURLs=t}},{key:"accept",set:function(t){this._accept=t},get:function(){return this._accept}}]),i}()}(),Lt=function(){function e(){t(this,e),this._element=null,this._inner=null,this._init()}return u(e,[{key:"_init",value:function(){this._element=b("div","slim-popover"),this._element.setAttribute("data-state","off"),document.body.appendChild(this._element)}},{key:"show",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._element.setAttribute("data-state","on"),h(this._element,{fromOpacity:0,opacity:1,duration:350,complete:function(){O(t._element),e()}})}},{key:"hide",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};h(this._element,{fromOpacity:1,opacity:0,duration:500,complete:function(){O(t._element),t._element.setAttribute("data-state","off"),e()}})}},{key:"destroy",value:function(){this._element.parentNode&&(this._element.parentNode.removeChild(this._element),this._element=null,this._inner=null)}},{key:"inner",set:function(t){this._inner=t,this._element.firstChild&&this._element.removeChild(this._element.firstChild),this._element.appendChild(this._inner)}},{key:"className",set:function(t){this._element.className="slim-popover"+(null===t?"":" "+t)}}]),e}(),Ot=function(t,e){return t.split(e).map(function(t){return parseInt(t,10)})},Dt=function(t){return"DIV"===t.nodeName||"SPAN"===t.nodeName},At={AUTO:"auto",INITIAL:"initial",MANUAL:"manual"},zt=["x","y","width","height"],Nt=["file-invalid-drop","file-invalid","file-drop","file-over","file-out","click"],Ut=["cancel","confirm"],Ht=["remove","edit","download","upload"],Bt=null,Ft=0,$t='\n<div class="slim-loader">\n\t<svg>\n\t\t<path class="slim-loader-background" fill="none" stroke-width="3" />\n\t\t<path class="slim-loader-foreground" fill="none" stroke-width="3" />\n\t</svg>\n</div>\n',Wt=function(t){var e=t.split(",");return{width:parseInt(e[0],10),height:parseInt(e[1],10)}},jt=function(){function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e),Bt||(Bt=new Lt),this._uid=Ft++,this._options=m(e.options(),n),this._options.forceSize&&("string"==typeof this._options.forceSize&&(this._options.forceSize=Wt(this._options.forceSize)),this._options.ratio=this._options.forceSize.width+":"+this._options.forceSize.height,this._options.size=_t(this._options.forceSize)),"string"==typeof this._options.size&&(this._options.size=Wt(this._options.size)),"string"==typeof this._options.minSize&&(this._options.minSize=Wt(this._options.minSize)),this._originalElement=i,this._originalElementInner=i.innerHTML,this._originalElementAttributes=f(i),Dt(i)?this._element=i:(this._element=St(i),this._element.className=i.className,i.className="",this._element.setAttribute("data-ratio",this._options.ratio)),this._element.classList.add("slim"),this._element.setAttribute("data-state","init"),this._state=[],this._timers=[],this._input=null,this._inputReference=null,this._output=null,this._ratio=null,this._isRequired=!1,this._imageHopper=null,this._imageEditor=null,this._progressEnabled=!0,this._data={},this._resetData(),this._drip=null,this._hasInitialImage=!1,this._initialCrop=this._options.crop,this._initialRotation=this._options.rotation&&this._options.rotation%90==0?this._options.rotation:null,this._isBeingDestroyed=!1,e.supported?this._init():this._fallback()}return u(e,[{key:"setRotation",value:function(t,e){if("number"==typeof t||t%90==0){this._data.actions.rotation=t;var i=this._data.actions.rotation%180!=0;if(this._data.input.image){var n=i?this._data.input.image.height:this._data.input.image.width,o=i?this._data.input.image.width:this._data.input.image.height;this._data.actions.crop=Q(n,o,this._ratio),this._data.actions.crop.type=At.AUTO}this._data.input.image&&e&&this._manualTransform(e)}}},{key:"setSize",value:function(t,e){"string"==typeof t&&(t=Wt(t)),t&&t.width&&t.height&&(this._options.size=_t(t),this._data.actions.size=_t(t),this._data.input.image&&e&&this._manualTransform(e))}},{key:"setRatio",value:function(t,e){var i=this;if(t&&"string"==typeof t&&(this._options.ratio=t,this._isFixedRatio())){var n=Ot(this._options.ratio,":");this._ratio=n[1]/n[0],this._data.input.image&&e?this._cropAuto(function(t){i._scaleDropArea(i._ratio),e&&e(t)}):(this._data.input.image&&(this._data.actions.crop=Q(this._data.input.image.width,this._data.input.image.height,this._ratio),this._data.actions.crop.type=At.AUTO),this._scaleDropArea(this._ratio),e&&e(null))}}},{key:"isAttachedTo",value:function(t){return this._element===t||this._originalElement===t}},{key:"isDetached",value:function(){return null===this._element.parentNode}},{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];"function"==typeof e?i=e:(this._options.crop=e.crop,this._options.rotation=e.rotation,this._initialRotation=e.rotation&&e.rotation%90==0?e.rotation:null,this._initialCrop=this._options.crop),this._load(t,i)}},{key:"upload",value:function(t){this._doUpload(t)}},{key:"download",value:function(){this._doDownload()}},{key:"remove",value:function(){return this._doRemove()}},{key:"destroy",value:function(){this._doDestroy()}},{key:"edit",value:function(){this._doEdit()}},{key:"crop",value:function(t,e){this._crop(t.x,t.y,t.width,t.height,e)}},{key:"containsImage",value:function(){return null!==this._data.input.name}},{key:"_canInstantEdit",value:function(){return this._options.instantEdit&&!this._isInitialising}},{key:"_getFileInput",value:function(){return this._element.querySelector("input[type=file]")}},{key:"_getInitialImage",value:function(){return this._element.querySelector("img")}},{key:"_getInputElement",value:function(){return this._getFileInput()||this._getInitialImage()}},{key:"_getRatioSpacerElement",value:function(){return this._element.children[0]}},{key:"_isImageOnly",value:function(){return"INPUT"!==this._input.nodeName}},{key:"_isFixedRatio",value:function(){return-1!==this._options.ratio.indexOf(":")}},{key:"_isAutoCrop",value:function(){return this._data.actions.crop.type===At.AUTO}},{key:"_toggleButton",value:function(t,e){kt('.slim-btn[data-action="'+t+'"]',e,this._element)}},{key:"_clearState",value:function(){this._state=[],this._updateState()}},{key:"_removeState",value:function(t){this._state=this._state.filter(function(e){return e!==t}),this._updateState()}},{key:"_addState",value:function(t){R(t,this._state)||(this._state.push(t),this._updateState())}},{key:"_updateState",value:function(){this._element&&this._element.setAttribute("data-state",this._state.join(","))}},{key:"_resetData",value:function(){this._data={server:null,meta:_t(this._options.meta),input:{field:this._inputReference,name:null,type:null,width:0,height:0,file:null},output:{image:null,width:0,height:0},actions:{rotation:null,crop:null,size:null}},this._output&&(this._output.value=""),ft(this._getFileInput())}},{key:"_init",value:function(){var t=this;if(this._isInitialising=!0,this._addState("empty"),R("input",this._options.post)&&(this._inputReference="slim_input_"+this._uid),this._input=this._getInputElement(),this._input||(this._input=b("input"),this._input.type="file",this._element.appendChild(this._input)),this._isRequired=!0===this._input.required,this._output=this._element.querySelector("input[type=hidden]"),this._output){var e=null;try{e=JSON.parse(this._output.value)}catch(t){}if(e){var i=new Image;i.src=e.output.image,i.setAttribute("data-filename",e.output.name),this._element.insertBefore(i,this._element.firstChild)}}else this._output=b("input"),this._output.type="hidden",this._output.name=this._input.name||this._options.defaultInputName,this._element.appendChild(this._output);this._input.removeAttribute("name");var n=b("div","slim-area"),o=this._getInitialImage(),a=(o||{}).src,r=o?o.getAttribute("data-filename"):null;a?this._hasInitialImage=!0:(this._initialCrop=null,this._initialRotation=null);var s='\n\t\t<div class="slim-result">\n\t\t\t<img class="in" style="opacity:0" '+(a?'src="'+a+'"':"")+'><img><img style="opacity:0">\n\t\t</div>';if(this._isImageOnly())n.innerHTML="\n\t\t\t\t"+$t+'\n\t\t\t\t\n<div class="slim-upload-status"></div>\n\n\t\t\t\t'+s+'\n\t\t\t\t<div class="slim-status"><div class="slim-label-loading">'+(this._options.labelLoading||"")+"</div></div>\n\t\t\t";else{R("input",this._options.post)&&(this._data.input.field=this._inputReference,this._options.service||(this._input.name=this._inputReference));var h=void 0;this._input.hasAttribute("accept")&&"image/*"!==this._input.getAttribute("accept")?h=this._input.accept.split(",").map(function(t){return t.trim()}).filter(function(t){return t.length>0}):(h=A(),this._input.setAttribute("accept",h.join(","))),this._imageHopper=new Rt,this._imageHopper.accept=h,this._imageHopper.allowURLs="string"==typeof this._options.fetcher,this._element.appendChild(this._imageHopper.element),Nt.forEach(function(e){t._imageHopper.element.addEventListener(e,t)}),n.innerHTML="\n\t\t\t\t"+$t+'\n\t\t\t\t\n<div class="slim-upload-status"></div>\n\n\t\t\t\t<div class="slim-drip"><span><span></span></span></div>\n\t\t\t\t<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+'</div><div class="slim-label-loading">'+(this._options.labelLoading||"")+"</div></div>\n\t\t\t\t"+s+"\n\t\t\t",this._input.addEventListener("change",this)}if(this._element.appendChild(n),this._btnGroup=b("div","slim-btn-group"),this._btnGroup.style.display="none",this._element.appendChild(this._btnGroup),Ht.filter(function(e){return t._isButtonAllowed(e)}).forEach(function(e){var i=I(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"]||n,a=t._options["button"+i+"ClassName"],r=b("button","slim-btn slim-btn-"+e+(a?" "+a:""));r.innerHTML=n,r.title=o,r.type="button",r.addEventListener("click",t),r.setAttribute("data-action",e),t._btnGroup.appendChild(r)}),this._isFixedRatio()){var l=Ot(this._options.ratio,":");this._ratio=l[1]/l[0],this._scaleDropArea(this._ratio)}this._updateProgress(.5),a?this._load(a,function(){t._onInit()},{name:r}):this._onInit()}},{key:"_onInit",value:function(){var t=this;this._isInitialising=!1;var e=function(){var e=setTimeout(function(){t._options.didInit.apply(t,[t.data,t])},0);t._timers.push(e)};this._options.saveInitialImage&&this.containsImage()?this._options.service||this._save(function(){e()},!1):(this._options.service&&this.containsImage()&&this._toggleButton("upload",!1),e())}},{key:"_updateProgress",value:function(t){if(t=Math.min(.99999,t),this._element&&this._progressEnabled){var e=this._element.querySelector(".slim-loader");if(e){var i=e.offsetWidth,n=e.querySelectorAll("path"),o=parseInt(n[0].getAttribute("stroke-width"),10);n[0].setAttribute("d",It(.5*i,.5*i,.5*i-o,.9999)),n[1].setAttribute("d",It(.5*i,.5*i,.5*i-o,t))}}}},{key:"_startProgress",value:function(t){var e=this;if(this._element){this._progressEnabled=!1;var i=this._element.querySelector(".slim-loader");if(i){var n=i.children[0];this._stopProgressLoop(function(){i.removeAttribute("style"),n.removeAttribute("style"),e._progressEnabled=!0,e._updateProgress(0),e._progressEnabled=!1,h(n,{fromOpacity:0,opacity:1,duration:250,complete:function(){e._progressEnabled=!0,t&&t()}})})}}}},{key:"_stopProgress",value:function(){var t=this;if(this._element){var e=this._element.querySelector(".slim-loader");if(e){var i=e.children[0];this._updateProgress(1),h(i,{fromOpacity:1,opacity:0,duration:250,complete:function(){e.removeAttribute("style"),i.removeAttribute("style"),t._updateProgress(.5),t._progressEnabled=!1}})}}}},{key:"_startProgressLoop",value:function(){if(this._element){var t=this._element.querySelector(".slim-loader");if(t){var e=t.children[0];t.removeAttribute("style"),e.removeAttribute("style"),this._updateProgress(.5);h(t,"stop"),h(t,{rotation:[0,0,-2*Math.PI*1e3],easing:"linear",duration:1e6}),h(e,{fromOpacity:0,opacity:1,duration:250})}}}},{key:"_stopProgressLoop",value:function(t){if(this._element){var e=this._element.querySelector(".slim-loader");if(e){var i=e.children[0];h(i,{fromOpacity:parseFloat(i.style.opacity),opacity:0,duration:250,complete:function(){h(e,"stop"),e.removeAttribute("style"),i.removeAttribute("style"),t&&t()}})}}}},{key:"_isButtonAllowed",value:function(t){return"edit"===t?this._options.edit:"download"===t?this._options.download:"upload"===t?!!this._options.service&&!this._options.push:"remove"!==t||!this._isImageOnly()}},{key:"_fallback",value:function(){var t=b("div","slim-area");t.innerHTML='\n\t\t\t<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+"</div></div>\n\t\t",this._element.appendChild(t),this._throwError(this._options.statusNoSupport)}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onChange(t);break;case"cancel":this._onCancel(t);break;case"confirm":this._onConfirm(t);break;case"file-over":this._onFileOver(t);break;case"file-out":this._onFileOut(t);break;case"file-drop":this._onDropFile(t);break;case"file-invalid":this._onInvalidFile(t);break;case"file-invalid-drop":this._onInvalidFileDrop(t)}}},{key:"_getIntro",value:function(){return this._element.querySelector(".slim-result .in")}},{key:"_getOutro",value:function(){return this._element.querySelector(".slim-result .out")}},{key:"_getInOut",value:function(){return this._element.querySelectorAll(".slim-result img")}},{key:"_getDrip",value:function(){return this._drip||(this._drip=this._element.querySelector(".slim-drip > span")),this._drip}},{key:"_throwError",value:function(t){this._addState("error"),this._element.querySelector(".slim-label").style.display="none";var e=this._element.querySelector(".slim-error");e||(e=b("div","slim-error"),this._element.querySelector(".slim-status").appendChild(e)),e.innerHTML=t}},{key:"_removeError",value:function(){this._removeState("error"),this._element.querySelector(".slim-label").style.display="";var t=this._element.querySelector(".slim-error");t&&t.parentNode.removeChild(t)}},{key:"_openFileDialog",value:function(){this._removeError(),this._input.click()}},{key:"_onClick",value:function(t){var e=this,i=t.target.classList,n=t.target;if(i.contains("slim-file-hopper"))return t.preventDefault(),void this._openFileDialog();switch(n.getAttribute("data-action")){case"remove":this._options.willRemove.apply(this,[this.data,function(){e._doRemove()}]);break;case"edit":this._doEdit();break;case"download":this._doDownload();break;case"upload":this._doUpload()}}},{key:"_onInvalidFileDrop",value:function(){this._onInvalidFile(),this._removeState("file-over");var t=this._getDrip();h(t.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){O(t.firstChild)}})}},{key:"_onInvalidFile",value:function(){var t=this._imageHopper.accept.map(N),e=this._options.statusFileType.replace("$0",t.join(", "));this._throwError(e)}},{key:"_onImageTooSmall",value:function(){var t=this._options.statusImageTooSmall.replace("$0",this._options.minSize.width+"  "+this._options.minSize.height);this._throwError(t)}},{key:"_onOverWeightFile",value:function(){var t=this._options.statusFileSize.replace("$0",this._options.maxFileSize);this._throwError(t)}},{key:"_onRemoteURLProblem",value:function(t){this._throwError(t)}},{key:"_onFileOver",value:function(t){this._addState("file-over"),this._removeError();var e=this._getDrip(),i=h.createMatrix();i.translate(t.detail.x,t.detail.y,0),h.setElementTransform(e,i),1==this._imageHopper.dragPath.length&&(e.style.opacity=1,h(e.firstChild,{fromOpacity:0,opacity:.5,fromScale:[0,0],scale:[.5,.5],duration:150}))}},{key:"_onFileOut",value:function(t){this._removeState("file-over"),this._removeState("file-invalid"),this._removeError();var e=this._getDrip(),i=h.createMatrix();i.translate(t.detail.x,t.detail.y,0),h.setElementTransform(e,i),h(e.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){O(e.firstChild)}})}},{key:"_onDropFile",value:function(t){var e=this;this._removeState("file-over");var i=this._getDrip(),n=h.createMatrix();n.translate(t.detail.x,t.detail.y,0),h.setElementTransform(i,n);var o=this._imageHopper.dragPath.length,a=this._imageHopper.dragPath[o-Math.min(10,o)],r=t.detail.x-a.x,s=t.detail.y-a.y;h(i,{fromPosition:[t.detail.x,t.detail.y,0],position:[t.detail.x+r,t.detail.y+s,0],duration:200}),h(i.firstChild,{fromScale:[.5,.5],scale:[2,2],fromOpacity:1,opacity:0,duration:200,complete:function(){O(i.firstChild),e._load(t.target.files[0])}})}},{key:"_onChange",value:function(t){t.target.files.length&&this._load(t.target.files[0])}},{key:"_load",value:function(t,e,i){var n=this;if(!this._isBeingDestroyed){if(this.containsImage())return clearTimeout(this._replaceTimeout),void this._doRemove(function(){n._replaceTimeout=setTimeout(function(){n._load(t,e,i)},100)});this._removeState("empty"),this._addState("busy"),this._startProgressLoop(),this._imageHopper&&(this._imageHopper.enabled=!1),clearTimeout(this._loadTimeout);var o=function(){n._imageHopper&&(n._imageHopper.enabled=!0),n._removeState("loading"),n._removeState("busy"),n._addState("empty"),n._stopProgressLoop()};if("string"!=typeof t)if(void 0!==t.remote&&this._options.fetcher)V(this._options.fetcher,t.remote,function(t){o(),n._onRemoteURLProblem("<p>"+t+"</p>"),e&&e.apply(n,["remote-url-problem"])},function(t){n._load(t,e,i)});else{var a=t;if(this._imageHopper&&-1===this._imageHopper.accept.indexOf(a.type))return o(),this._onInvalidFile(),void(e&&e.apply(this,["file-invalid"]));if(a.size&&this._options.maxFileSize&&D(a.size)>this._options.maxFileSize)return o(),this._onOverWeightFile(),void(e&&e.apply(this,["file-too-big"]));this._imageEditor&&this._imageEditor.dirty(),this._data.input.name=i&&i.name?i.name:$(a),this._data.input.type=W(a),this._data.input.size=a.size,this._data.input.file=a,Z(a,this._options.internalCanvasSize,function(t,i){var o=function(){n._imageHopper&&(n._imageHopper.enabled=!0),n._removeState("loading"),n._removeState("busy"),n._addState("empty"),n._stopProgressLoop(),n._resetData()};if(!t)return o(),void(e&&e.apply(n,["file-not-found"]));if(!ct(t,n._options.minSize))return o(),n._onImageTooSmall(),void(e&&e.apply(n,["image-too-small"]));var r=n._options.didLoad.apply(n,[a,t,i,n]);if(!0!==r)return o(),!1!==r&&n._throwError(r),void(e&&e.apply(n,[r]));n._removeState("loading");var s=function(t){n._imageHopper&&n._options.dropReplace&&(n._imageHopper.enabled=!0);var e=n._getIntro(),i={fromScale:[1.25,1.25],scale:[1,1],fromOpacity:0,opacity:1,complete:function(){O(e),e.style.opacity=1,t()}};n.isDetached()?i.duration=1:(i.easing="spring",i.springConstant=.3,i.springDeceleration=.7),n._canInstantEdit()&&(i.delay=500,i.duration=1,n._doEdit()),h(e,i)};n._loadCanvas(t,function(t){n._addState("preview"),s(function(){n._canInstantEdit()||t||n._showButtons(),t||(n._stopProgressLoop(),n._removeState("busy")),e&&e.apply(n,[null,n.data])})},function(){n._canInstantEdit()||n._showButtons(),n._removeState("busy")})})}else G(t)?this._load(K(t),e,i):(clearTimeout(n._loadTimeout),n._loadTimeout=setTimeout(function(){n._isBeingDestroyed||(n._addState("loading"),h(n._element.querySelector(".slim-label-loading"),{fromOpacity:0,opacity:1,duration:250}))},500),X(t,function(t){n._load(t,e,i)}))}}},{key:"_loadCanvas",value:function(t,e,i){var n=this;if(!this._isBeingDestroyed){this._data.input.image=t,this._data.input.width=t.width,this._data.input.height=t.height,this._initialRotation&&(this._data.actions.rotation=this._initialRotation,this._initialRotation=null);var o=this._data.actions.rotation%180!=0;this._isFixedRatio()||(this._initialCrop?this._ratio=this._initialCrop.height/this._initialCrop.width:this._ratio=o?t.width/t.height:t.height/t.width,this._scaleDropArea(this._ratio)),this._initialCrop?(this._data.actions.crop=_t(this._initialCrop),this._data.actions.crop.type=At.INITIAL,this._initialCrop=null):(this._data.actions.crop=Q(o?t.height:t.width,o?t.width:t.height,this._ratio),this._data.actions.crop.type=At.AUTO),this._options.size&&(this._data.actions.size={width:this._options.size.width,height:this._options.size.height}),this._applyTransforms(t,function(t){var o=n._getIntro(),a=o.offsetWidth/t.width,r=!1;n._options.service&&n._options.push&&(n._hasInitialImage||n._canInstantEdit()||(r=!0,n._stopProgressLoop(function(){n._startProgress(function(){n._updateProgress(.1)})}))),n._canInstantEdit()||n._save(function(){n._isBeingDestroyed||r&&(n._stopProgress(),i())},r),o.src="",o.src=st(t,a).toDataURL(),o.onload=function(){o.onload=null,n._isBeingDestroyed||e&&e(r)}})}}},{key:"_applyTransforms",value:function(t,e){var i=this,n=_t(this._data.actions);n.filters={sharpen:this._options.filterSharpen/100},n.minSize=this._options.minSize,tt(t,n,function(t){var n=t;if((i._options.forceSize||i._options.size&&1==at(i._options.size,t))&&((n=b("canvas")).width=i._options.size.width,n.height=i._options.size.height,n.getContext("2d").drawImage(t,0,0,i._options.size.width,i._options.size.height)),i._options.size&&i._options.minSize.width===i._options.size.width&&i._options.minSize.height===i._options.size.height&&(n.width<i._options.minSize.width||n.height<i._options.minSize.height)){var o=Math.max(n.width,i._options.minSize.width),a=Math.max(n.height,i._options.minSize.height);(n=b("canvas")).width=o,n.height=a,n.getContext("2d").drawImage(t,0,0,o,a)}i._data.output.width=n.width,i._data.output.height=n.height,i._data.output.image=n,i._onTransformCanvas(function(t){i._data=t,i._options.didTransform.apply(i,[i.data,i]),e(i._data.output.image)})})}},{key:"_onTransformCanvas",value:function(t){this._options.willTransform.apply(this,[this.data,t,this])}},{key:"_appendEditor",value:function(){var t=this;this._imageEditor||(this._imageEditor=new Mt(b("div"),{minSize:this._options.minSize,buttonConfirmClassName:this._options.buttonConfirmClassName,buttonCancelClassName:this._options.buttonCancelClassName,buttonRotateClassName:this._options.buttonRotateClassName,buttonConfirmLabel:this._options.buttonConfirmLabel,buttonCancelLabel:this._options.buttonCancelLabel,buttonRotateLabel:this._options.buttonRotateLabel,buttonConfirmTitle:this._options.buttonConfirmTitle,buttonCancelTitle:this._options.buttonCancelTitle,buttonRotateTitle:this._options.buttonRotateTitle}),Ut.forEach(function(e){t._imageEditor.element.addEventListener(e,t)}))}},{key:"_scaleDropArea",value:function(t){var e=this._getRatioSpacerElement();e&&this._element&&(e.style.marginBottom=100*t+"%",this._element.setAttribute("data-ratio","1:"+t))}},{key:"_onCancel",value:function(t){this._removeState("editor"),this._options.didCancel.apply(this,[this]),this._showButtons(),this._hideEditor(),this._options.instantEdit&&!this._hasInitialImage&&this._isAutoCrop()&&this._doRemove()}},{key:"_onConfirm",value:function(t){var e=this,i=this._options.service&&this._options.push;i?this._startProgress(function(){e._updateProgress(.1)}):this._startProgressLoop(),this._removeState("editor"),this._addState("busy"),this._output.value="",this._data.actions.rotation=t.detail.rotation,this._data.actions.crop=t.detail.crop,this._data.actions.crop.type=At.MANUAL,this._applyTransforms(this._data.input.image,function(t){e._options.didConfirm.apply(e,[e.data,e]);var n=e._getInOut(),o="out"===n[0].className?n[0]:n[1],a=o===n[0]?n[1]:n[0];o.className="in",o.style.opacity="0",o.style.zIndex="2",a.className="out",a.style.zIndex="1",o.src="",o.src=st(t,o.offsetWidth/t.width).toDataURL(),o.onload=function(){o.onload=null,"free"===e._options.ratio&&(e._ratio=o.naturalHeight/o.naturalWidth,e._scaleDropArea(e._ratio)),e._hideEditor();var t=setTimeout(function(){e._showPreview(o,function(){e._save(function(t,n,o){e._toggleButton("upload",!0),i?e._stopProgress():e._stopProgressLoop(),e._removeState("busy"),e._showButtons()},i)})},250);e._timers.push(t)}})}},{key:"_cropAuto",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t){},e=this._data.actions.rotation%180!=0,i=Q(e?this._data.input.image.width:this._data.input.image.height,e?this._data.input.image.height:this._data.input.image.width,this._ratio);this._crop(i.x,i.y,i.width,i.height,t,At.AUTO)}},{key:"_crop",value:function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:At.MANUAL;this._output.value="",this._data.actions.crop={x:t,y:e,width:i,height:n},this._data.actions.crop.type=a,this._manualTransform(o)}},{key:"_manualTransform",value:function(t){var e=this;this._startProgressLoop(),this._addState("busy"),this._applyTransforms(this._data.input.image,function(i){var n=e._getInOut(),o="out"===n[0].className?n[0]:n[1],a=o===n[0]?n[1]:n[0];o.className="in",o.style.opacity="1",o.style.zIndex="2",a.className="out",a.style.zIndex="0",o.src="",o.src=st(i,o.offsetWidth/i.width).toDataURL(),o.onload=function(){o.onload=null,"free"===e._options.ratio&&(e._ratio=o.naturalHeight/o.naturalWidth,e._scaleDropArea(e._ratio));var i=e._options.service&&e._options.push,n=function(){e._save(function(n,o,a){i||e._stopProgressLoop(),e._removeState("busy"),t.apply(e,[e.data])},i)};i?e._startProgress(n):n()}})}},{key:"_save",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._isBeingDestroyed){var n=this.dataBase64;this._options.service||this._isInitialising&&!this._isImageOnly()||this._options.willSave.apply(this,[n,function(e){t._store(e),t._options.didSave.apply(t,[e,t])},this]),this._isBeingDestroyed||(this._options.service&&i&&this._options.willSave.apply(this,[n,function(i){t._addState("upload"),t._imageHopper&&t._options.dropReplace&&(t._imageHopper.enabled=!1),t._upload(i,function(n,o){t._imageHopper&&t._options.dropReplace&&(t._imageHopper.enabled=!0),n||t._storeServerResponse(o),t._options.didUpload.apply(t,[n,i,o,t]),t._removeState("upload"),e(n,i,o)})},this]),this._options.service&&i||e())}}},{key:"_storeServerResponse",value:function(t){this._isRequired&&(this._input.required=!1),this._data.server=t,this._output.value="object"===(void 0===t?"undefined":c(t))?JSON.stringify(this._data.server):t}},{key:"_store",value:function(t){this._isRequired&&(this._input.required=!1),this._output.value=JSON.stringify(t)}},{key:"_upload",value:function(t,e){var n=this;i.parseMetaData(this._data.input.file,function(o){var a=[],r=new FormData;if(R("input",n._options.post)&&(a.push(n._data.input.file),r.append(n._inputReference,n._data.input.file,n._data.input.file.name)),R("output",n._options.post)&&null!==n._data.output.image&&!1===n._options.uploadBase64){var s=K(t.output.image,t.output.name);if(o.imageHead&&n._options.copyImageHead)try{s=new Blob([o.imageHead,i.blobSlice.call(s,20)],{type:yt(t.output.image)}),s=q(s,t.output.name)}catch(t){}a.push(s);var h="slim_output_"+n._uid;t.output.image=null,t.output.field=h,r.append(h,s,t.output.name)}r.append(n._output.name,JSON.stringify(t));var l=n._element.querySelector(".slim-upload-status"),u=n._options.willRequest,c=function(t,e){n._updateProgress(Math.max(.1,t/e))},p=function(t){var i=setTimeout(function(){if(!n._isBeingDestroyed){l.innerHTML=n._options.statusUploadSuccess,l.setAttribute("data-state","success"),l.style.opacity=1;var t=setTimeout(function(){l.style.opacity=0},2e3);n._timers.push(t)}},250);n._timers.push(i),e(null,t)},d=function(t){var i="";i="file-too-big"===t?n._options.statusContentLength:n._options.didReceiveServerError.apply(n,[t,n._options.statusUnknownResponse,n]);var o=setTimeout(function(){l.innerHTML=i,l.setAttribute("data-state","error"),l.style.opacity=1},250);n._timers.push(o),e(t)};"string"==typeof n._options.service?L(n._options.service,r,u,c,p,d):"function"==typeof n._options.service&&n._options.service.apply(n,["file"===n._options.serviceFormat?a:r,c,p,d])},{maxMetaDataSize:262144,disableImageHead:!1})}},{key:"_showEditor",value:function(){Bt.className=this._options.popoverClassName,Bt.show(),this._imageEditor.show()}},{key:"_hideEditor",value:function(){this._imageEditor.hide();var t=setTimeout(function(){Bt.hide()},250);this._timers.push(t)}},{key:"_showPreview",value:function(t,e){h(t,{fromPosition:[0,50,0],position:[0,0,0],fromScale:[1.5,1.5],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.7,complete:function(){O(t),e&&e()}})}},{key:"_hideResult",value:function(t){var e=this._getIntro();e&&h(e,{fromScale:[1,1],scale:[.5,.5],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,complete:function(){O(e),t&&t()}})}},{key:"_showButtons",value:function(t){if(this._btnGroup){this._btnGroup.style.display="";var e={fromScale:[.5,.5],scale:[1,1],fromPosition:[0,10,0],position:[0,0,0],fromOpacity:0,opacity:1,complete:function(){O(this)},allDone:function(){t&&t()}};this.isDetached()?e.duration=1:(e.delay=function(t){return 250+50*t},e.easing="spring",e.springConstant=.3,e.springDeceleration=.85),h(this._btnGroup.childNodes,e)}}},{key:"_hideButtons",value:function(t){var e=this;if(this._btnGroup){var i={fromScale:[1,1],scale:[.85,.85],fromOpacity:1,opacity:0,allDone:function(){e._btnGroup.style.display="none",t&&t()}};this.isDetached()?i.duration=1:(i.easing="spring",i.springConstant=.3,i.springDeceleration=.75),h(this._btnGroup.childNodes,i)}}},{key:"_hideStatus",value:function(){this._element.querySelector(".slim-upload-status").style.opacity=0}},{key:"_doEdit",value:function(){var t=this;this._data.input.image&&(this._addState("editor"),this._imageEditor||this._appendEditor(),this._imageEditor.showRotateButton=this._options.rotateButton,Bt.inner=this._imageEditor.element,this._imageEditor.open(rt(this._data.input.image),"free"===this._options.ratio?null:this._ratio,this._data.actions.crop,this._data.actions.rotation,function(){t._showEditor(),t._hideButtons(),t._hideStatus()}))}},{key:"_doRemove",value:function(t){var e=this;if(!this._isImageOnly()){this._clearState(),this._addState("empty"),this._hasInitialImage=!1,this._imageHopper&&(this._imageHopper.enabled=!0),this._isRequired&&(this._input.required=!0);var i=this._getOutro();i&&(i.style.opacity="0");var n=this.data;this._resetData();var o=setTimeout(function(){e._isBeingDestroyed||(e._hideButtons(function(){e._toggleButton("upload",!0)}),e._hideStatus(),e._hideResult(),e._options.didRemove.apply(e,[n,e]),t&&t())},this.isDetached()?0:250);return this._timers.push(o),n}}},{key:"_doUpload",value:function(t){var e=this;this._data.input.image&&(this._addState("upload"),this._startProgress(),this._hideButtons(function(){e._toggleButton("upload",!1),e._save(function(i,n,o){e._removeState("upload"),e._stopProgress(),t&&t.apply(e,[i,n,o]),i&&e._toggleButton("upload",!0),e._showButtons()})}))}},{key:"_doDownload",value:function(){this._data.output.image&&bt(this._data,this._options.jpegCompression,this._options.forceType)}},{key:"_doDestroy",value:function(){function t(t,e){return 0!==e.filter(function(e){return t.name===e.name&&t.value===e.value}).length}var e=this;this._isBeingDestroyed=!0,this._timers.forEach(function(t){clearTimeout(t)}),this._timers=[],h(this._element,"detach"),this._imageHopper&&(Nt.forEach(function(t){e._imageHopper.element.removeEventListener(t,e)}),this._imageHopper.destroy(),this._imageHopper=null),this._imageEditor&&(Ut.forEach(function(t){e._imageEditor.element.removeEventListener(t,e)}),this._imageEditor.destroy(),this._imageEditor=null),Ct(this._btnGroup.children).forEach(function(t){t.removeEventListener("click",e)}),this._input.removeEventListener("change",this),this._element!==this._originalElement&&this._element.parentNode&&this._element.parentNode.replaceChild(this._originalElement,this._element),this._originalElement.innerHTML=this._originalElementInner;var i=f(this._originalElement);i.forEach(function(i){t(i,e._originalElementAttributes)||e._originalElement.removeAttribute(i.name)}),this._originalElementAttributes.forEach(function(n){t(n,i)||e._originalElement.setAttribute(n.name,n.value)}),Ft=Math.max(0,Ft-1),Bt&&0===Ft&&(Bt.destroy(),Bt=null),this._originalElement=null,this._element=null,this._input=null,this._output=null,this._btnGroup=null,this._options=null}},{key:"dataBase64",get:function(){return wt(this._data,this._options.post,this._options.jpegCompression,this._options.forceType,null!==this._options.service)}},{key:"data",get:function(){return gt(this._data)}},{key:"element",get:function(){return this._element}},{key:"service",set:function(t){this._options.service=t}},{key:"size",set:function(t){this.setSize(t,null)}},{key:"rotation",set:function(t){this.setRotation(t,null)}},{key:"ratio",set:function(t){this.setRatio(t,null)}}],[{key:"options",value:function(){var t={edit:!0,instantEdit:!1,uploadBase64:!1,meta:{},ratio:"free",size:null,rotation:null,crop:null,post:["output","actions"],service:null,serviceFormat:null,filterSharpen:0,push:!1,defaultInputName:"slim[]",minSize:{width:0,height:0},maxFileSize:null,jpegCompression:null,download:!1,saveInitialImage:!1,forceType:!1,forceSize:null,dropReplace:!0,fetcher:null,internalCanvasSize:{width:4096,height:4096},copyImageHead:!1,rotateButton:!0,popoverClassName:null,label:"<p>Drop your image here</p>",labelLoading:"<p>Loading image...</p>",statusFileType:"<p>Invalid file type, expects: $0.</p>",statusFileSize:"<p>File is too big, maximum file size: $0 MB.</p>",statusNoSupport:"<p>Your browser does not support image cropping.</p>",statusImageTooSmall:"<p>Image is too small, minimum size is: $0 pixels.</p>",statusContentLength:'<span class="slim-upload-status-icon"></span> The file is probably too big',statusUnknownResponse:'<span class="slim-upload-status-icon"></span> An unknown error occurred',statusUploadSuccess:'<span class="slim-upload-status-icon"></span> Saved',didInit:function(t){},didLoad:function(t,e,i){return!0},didSave:function(t){},didUpload:function(t,e,i){},didReceiveServerError:function(t,e){return e},didRemove:function(t){},didTransform:function(t){},didConfirm:function(t){},didCancel:function(){},willTransform:function(t,e){e(t)},willSave:function(t,e){e(t)},willRemove:function(t,e){e()},willRequest:function(t){}};return Ht.concat(Mt.Buttons).concat("rotate").forEach(function(e){var i=I(e);t["button"+i+"ClassName"]=null,t["button"+i+"Label"]=i,t["button"+i+"Title"]=i}),t}}]),e}();return function(){function t(t){return t?"<p>"+t+"</p>":null}function e(t){var e=window,i=t.split(".");return i.forEach(function(t,n){e[i[n]]&&(e=e[i[n]])}),e!==window?e:null}var i=[],n=function(t){for(var e=0,n=i.length;e<n;e++)if(i[e].isAttachedTo(t))return e;return-1},o=function(t){return t},a=function(t){return"true"===t},r=function(t){return!t||"true"===t},s=function(e){return t(e)},h=function(t){return t?e(t):null},l=function(t){if(!t)return null;var e=Ot(t,",");return{width:e[0],height:e[1]}},u=function(t){return t?parseInt(t,10):null},c={download:a,edit:r,instantEdit:a,minSize:l,size:l,forceSize:l,internalCanvasSize:l,service:function(t){if(void 0===t)return null;var i=e(t);return i||t},serviceFormat:function(t){return void 0===t?null:t},fetcher:function(t){return void 0===t?null:t},push:a,rotation:function(t){return void 0===t?null:parseInt(t,10)},crop:function(t){if(!t)return null;var e={};return t.split(",").map(function(t){return parseInt(t,10)}).forEach(function(t,i){e[zt[i]]=t}),e},post:function(t){return t?t.split(",").map(function(t){return t.trim()}):null},defaultInputName:o,ratio:function(t){return t||null},maxFileSize:function(t){return t?parseFloat(t):null},filterSharpen:u,jpegCompression:u,uploadBase64:a,forceType:o,dropReplace:r,saveInitialImage:a,copyImageHead:a,rotateButton:r,label:s,labelLoading:s,popoverClassName:o};["FileSize","FileType","NoSupport","ImageTooSmall"].forEach(function(t){c["status"+t]=s}),["ContentLength","UnknownResponse","UploadSuccess"].forEach(function(t){c["status"+t]=o}),["Init","Load","Save","Upload","Remove","Transform","ReceiveServerError","Confirm","Cancel"].forEach(function(t){c["did"+t]=h}),["Transform","Save","Remove","Request"].forEach(function(t){c["will"+t]=h});var d=["ClassName","Label","Title"];Ht.concat(Mt.Buttons).concat("rotate").forEach(function(t){var e=I(t);d.forEach(function(t){c["button"+e+t]=o})}),jt.supported=!("[object OperaMini]"===Object.prototype.toString.call(window.operamini)||void 0===window.addEventListener||void 0===window.FileReader||!("slice"in Blob.prototype)||void 0===window.URL||void 0===window.URL.createObjectURL),jt.parse=function(t){var e,i,n,o=[];for(n=(e=t.querySelectorAll(".slim:not([data-state])")).length;n--;)i=e[n],o.push(jt.create(i,jt.getOptionsFromAttributes(i)));return o},jt.getOptionsFromAttributes=function(t){var e=p(t),i={meta:{}};for(var n in e){var o=c[n],a=e[n];o?(a=null===(a=o(a))?_t(jt.options()[n]):a,i[n]=a):0===n.indexOf("meta")&&(i.meta[T(n.substr(4))]=a)}return i},jt.find=function(t){var e=i.filter(function(e){return e.isAttachedTo(t)});return e?e[0]:null},jt.create=function(t,e){if(!jt.find(t)){e||(e=jt.getOptionsFromAttributes(t));var n=new jt(t,e);return i.push(n),n}},jt.destroy=function(t){var e=n(t);return!(e<0)&&(i[e].destroy(),i.splice(e,1),!0)}}(),jt}(),i={};for(var n in e.options())/^(did|will)/.test(n)&&(i[n]="=");i.service="=";for(var o=["rotation","size","ratio"],a=0;a<o.length;a++)i[o[a]]="@";o.push("service"),t.module("slim",[]).directive("slim",function(){return{restrict:"EC",scope:i,link:function(t,n,a){var r=null,s=null,h=n[0],l=document.createElement("div");l.className="slim";var u=h.innerHTML;if(h.innerHTML="",h.appendChild(l),l.innerHTML=u,a.initialImage){var c=document.createElement("img");c.src=a.initialImage,c.setAttribute("alt",""),l.appendChild(c)}s=e.getOptionsFromAttributes(h);for(var p in i)t[p]&&(s[p]=t[p]);r=e.create(l,s),o.forEach(function(e){t.$watch(e,function(t,i){t!==i&&(r[e]=t)},!0)})}}})}(angular),angular.module("ngGeolocation",[]).factory("$geolocation",["$rootScope","$window","$q",function(t,e,i){function n(){return"geolocation"in e.navigator}var o={getCurrentPosition:function(a){var r=i.defer();return n()?e.navigator.geolocation.getCurrentPosition(function(e){t.$apply(function(){o.position.coords=e.coords,o.position.timestamp=e.timestamp,r.resolve(e)})},function(e){t.$apply(function(){r.reject({error:e})})},a):r.reject({error:{code:2,message:"This web browser does not support HTML5 Geolocation"}}),r.promise},watchPosition:function(i){n()?this.watchId||(this.watchId=e.navigator.geolocation.watchPosition(function(e){t.$apply(function(){o.position.coords=e.coords,o.position.timestamp=e.timestamp,delete o.position.error,t.$broadcast("$geolocation.position.changed",e)})},function(e){t.$apply(function(){o.position.error=e,delete o.position.coords,delete o.position.timestamp,t.$broadcast("$geolocation.position.error",e)})},i)):o.position={error:{code:2,message:"This web browser does not support HTML5 Geolocation"}}},clearWatch:function(){this.watchId&&(e.navigator.geolocation.clearWatch(this.watchId),delete this.watchId)},position:{}};return o}]);var env={};window&&Object.assign(env,window.__env);var app=angular.module("takeNGo",["slim","ngGeolocation","ngCookies","ngMap"]).constant("ENV",env).config(["$httpProvider",function(t){t.defaults.withCredentials=!0}]).config(["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]);app.controller("mainController",["$scope","$timeout","$http","$rootScope","ENV","$geolocation","$cookies",function(t,e,i,n,o,a,r){t.digest=function(t){return e(function n(){if(i.pendingRequests.length>0)e(n);else if(t)return t()})},t.range=function(t){return new Array(t)},n.metadata={signed_in:!1,email_verified:!1,signing:!0,tng_uid:"",email:"",loading:{sign_up:!1,sign_in:!1},auth:{},current_location:null,current_location_retrieved:!1},a.watchPosition({timeout:6e4,maximumAge:250,enableHighAccuracy:!0}),console.log(a),t.$on("$geolocation.position.changed",function(e,i){n.metadata.current_location={latitude:i.coords.latitude,longitude:i.coords.longitude,timestamp:i.timestamp},n.metadata.current_location_retrieved=!0,console.log(n.metadata.current_location),t.digest()}),t.modalFunc={closeAuth:function(){$("#signup-form").modal("hide"),$("#login-form").modal("hide"),$("#forget-password-form").modal("hide")}},t.authenticate={},t.authenticate.check=function(){t.authenticate.check_token().then(function(){t.modalFunc.closeAuth(),t.authenticate.get_profile().then(function(e){var i=(e.data||{}).user;n.metadata.signing=!1,n.metadata=Object.assign(n.metadata,{signed_in:!0,email:i.email,uid:i.uid,email_verified:i.s_verified}),t.digest(),console.log(n.metadata)}).catch(function(){t.authenticate.sign_out()})}).catch(function(){t.authenticate.sign_out()})},t.authenticate.get_profile=function(){return new Promise(function(t,e){i.post(o.API_URL+"profile",{},{headers:{"X-TKNG-UID":n.metadata.auth.uid,"X-TKNG-TKN":n.metadata.auth.token,"X-TKNG-EM":n.metadata.auth.email}}).then(function(e){console.log("get_profile"),console.log(e),console.log("end of get_profile"),t(e)},function(t){console.log("err get_profile"),console.log(t),console.log("end of get_profile"),e()})})},t.authenticate.check_token=function(){return new Promise(function(t,e){i.post(o.API_URL+"token").then(function(i){console.log("check_token"),console.log(i),console.log("end of check_token"),"OK"==i.data.status?(console.log(i.data),n.metadata.auth={uid:i.data.uid,token:i.data.token,email:i.data.email,first_name:i.data.first_name},r.put("fe_uid",i.data.uid),r.put("fe_token",i.data.token),r.put("fe_email",i.data.email),t()):e()},function(t){console.log("check_token err"),console.log(t.data),console.log("end of check_token err"),e()})})},t.authenticate.register_auth=function(){return new Promise(function(t,e){i.post("/register-auth",{},{headers:{"X-TKNG-UID":n.metadata.auth.uid,"X-TKNG-TKN":n.metadata.auth.token,"X-TKNG-EM":n.metadata.auth.email}}).then(function(e){t(),console.log(e)},function(t){console.log(t),e()})})},t.authenticate.sign_out=function(){console.log("signing out"),n.metadata.signing=!1,n.metadata=Object.assign(n.metadata,{signed_in:!1,email_verified:!1,tng_uid:"",email:""}),i.post(o.API_URL+"reset_auth").then(function(t){console.log(t)},function(t){}),t.digest()},$(document).ready(function(){setTimeout(t.authenticate.check,500)})}]),app.controller("signInController",["$scope","$rootScope","$timeout","$http","ENV",function(t,e,i,n,o){t.signin_error={email:!1,password:!1,error:!1,message:{email:[],password:[],error:[]}},t.reset_input=function(){t.signin_information={email:"",password:""}};var a=function(){t.signin_error.error=!1,t.signin_error.message.error=[]};t.reset_input(),t.signin=function(){var i=t.signin_information,r=i.email,s=i.password;e.metadata.loading.sign_in=!0,n.post(o.API_URL+"login",{email:r,password:s}).then(function(i){console.log(i),e.metadata.loading.sign_in=!1,t.reset_input(),a(),t.authenticate.check(),t.modalFunc.closeAuth()},function(i){i.data;t.signin_error.error=!0,t.signin_error.message.error=["Invalid email or password!"],e.metadata.loading.sign_in=!1,t.digest()})}}]),app.controller("signUpController",["$scope","$rootScope","$timeout","$http","ENV",function(t,e,i,n,o){t.signup_error={first_name:!1,last_name:!1,email:!1,password_confirmation:!1,password:!1,message:{first_name:[],last_name:[],email:[],password_confirmation:[],password:[]}},t.reset_input=function(){t.signup_information={first_name:"",last_name:"",email:"",password:"",password_confirmation:""}},t.reset_input();var a=function(){t.signup_error.first_name=!1,t.signup_error.message.first_name=[],t.signup_error.last_name=!1,t.signup_error.message.last_name=[],t.signup_error.email=!1,t.signup_error.message.email=[],t.signup_error.password=!1,t.signup_error.message.password=[],t.signup_error.password_confirmation=!1,t.signup_error.message.password_confirmation=[]};t.signup=function(){var i=t.signup_information,r=i.first_name,s=i.last_name,h=i.email,l=i.password,u=i.password_confirmation;if(l!=u)return t.signup_error.password_confirmation=!0,void(t.signup_error.message.password_confirmation=["Password does not match"]);e.metadata.loading.sign_up=!0,n.post(o.API_URL+"register",{first_name:r,last_name:s,email:h,password:l,password_confirmation:u}).then(function(i){console.log(i),e.metadata.loading.sign_up=!1,t.reset_input(),a(),t.authenticate.check(),t.modalFunc.closeAuth(),$("#sign-up-success").modal("show")},function(i){if(422==i.status){var n=i.data;console.log(n),n.first_name&&(t.signup_error.first_name=!0,t.signup_error.message.first_name=n.first_name),n.last_name&&(t.signup_error.last_name=!0,t.signup_error.message.last_name=n.last_name),n.email&&(t.signup_error.email=!0,t.signup_error.message.email=n.email),n.password&&(t.signup_error.password=!0,t.signup_error.message.password=n.password),n.password_confirmation&&(t.signup_error.password_confirmation=!0,t.signup_error.message.password_confirmation=n.password_confirmation),e.metadata.loading.sign_up=!1,t.digest()}})}}]),app.controller("headerController",["$scope","$rootScope",function(t,e){}]),app.controller("profileEditController",["$scope","$rootScope","$http","ENV",function(t,e,i,n){t.profile_error={first_name:!1,last_name:!1,gender:!1,birth_date:!1,address:!1,suburb:!1,state:!1,post_code:!1,message:{first_name:[],last_name:[],gender:[],birth_date:[],address:[],suburb:[],state:[],post_code:[]}},t.profile_form={first_name:"",last_name:"",gender:"",birth_date:moment().format("DD MMMM YYYY"),address:"",suburb:"",state:"",post_code:""},$("#caleran-header").caleran({singleDate:!0,calendarCount:1,showHeader:!1,showFooter:!1,autoCloseOnSelect:!0,format:"DD MMMM YYYY",maxDate:new Date,enableKeyboard:!0,onafterselect:function(e,i,n){t.profile_form.birth_date=i.format("DD MMMM YYYY"),t.digest()}}),t.save_profile=function(){i.put(n.API_URL+"profile/edit",t.profile_form,{headers:{"X-TKNG-UID":e.metadata.auth.uid,"X-TKNG-TKN":e.metadata.auth.token,"X-TKNG-EM":e.metadata.auth.email}}).then(function(t){console.log(t)},function(e){if(console.log(e),422==e.status){var i=e.data;i.first_name&&(t.profile_error.first_name=!0,t.profile_error.message.first_name=i.first_name),i.last_name&&(t.profile_error.last_name=!0,t.profile_error.message.last_name=i.last_name),i.gender&&(t.profile_error.gender=!0,t.profile_error.message.gender=i.gender),i.phone&&(t.profile_error.phone=!0,t.profile_error.message.phone=i.phone),i.birth_date&&(t.profile_error.birth_date=!0,t.profile_error.message.birth_date=i.birth_date),i.address&&(t.profile_error.address=!0,t.profile_error.message.address=i.address),i.suburb&&(t.profile_error.suburb=!0,t.profile_error.message.suburb=i.suburb),i.state&&(t.profile_error.state=!0,t.profile_error.message.state=i.state),i.post_code&&(t.profile_error.post_code=!0,t.profile_error.message.post_code=i.post_code),t.digest()}})}}]),app.controller("profileDocumentController",["$scope","$rootScope","$http","ENV",function(t,e,i,n){t.slim={api_url:n.API_URL+"user/document/upload",init:function(t,e){console.log(e),console.log(t)},will_request:function(t){t.setRequestHeader("X-TKNG-UID",e.metadata.auth.uid),t.setRequestHeader("X-TKNG-TKN",e.metadata.auth.token),t.setRequestHeader("X-TKNG-EM",e.metadata.auth.email),console.log(e.metadata.auth.uid)},upload:function(t,e,i){console.log(t,e,i)}}}]),app.controller("carsCollectionController",["$scope","$rootScope","$http","ENV","$location","NgMap",function(t,e,i,n,o,a){console.log("Going to Cars Collection Page");var r=o.search(),s=1;r.hasOwnProperty("page")&&!isNaN(r.page)&&(s=r.page),t.map=null,a.getMap().then(function(e){console.log(e),t.map=e}).catch(function(t){console.log(t)}),console.log("RETRIEVED PARAMS",r),t.cars=[],t.carsLocations=[];var h=function(){t.cars=[],t.carsLocations=[]};t.carsCollectionCtrl={loading:{retrieve:!0},error:{retrieve:!1,message:{retrieve:[]}},current_page:s,last_page:0,pagination:{next:!1,prev:!1},api_url:n.API_URL};var l=t.$watch("metadata.current_location_retrieved",function(e,i){e!=i&&!0===e&&(t.retrieve(),l())}),u=function(){t.carsCollectionCtrl.error.retrieve=!1,t.carsCollectionCtrl.error.message.retrieve=[]};t.changePage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e>t.carsCollectionCtrl.last_page?e=t.carsCollectionCtrl.last_page:isNaN(e)&&(e=1),t.carsCollectionCtrl.current_page=e,e!=t.carsCollectionCtrl.current_page?(o.search("page",t.carsCollectionCtrl.current_page),t.retrieve()):console.log("It's the same page!")},t.retrieve=function(){var e=c();t.carsCollectionCtrl.loading.retrieve=!0,console.log("RETRIEVING CARS"),console.log("GET URL: ",n.API_URL+"cars?"+e),h(),i.get(n.API_URL+"cars?"+e).then(function(e){console.log(e.data);var i=e.data;t.cars=i.data,t.carsCollectionCtrl.last_page=i.last_page,t.carsCollectionCtrl.current_page=i.current_page,t.carsCollectionCtrl.pagination.next=null!==i.next_page_url,t.carsCollectionCtrl.pagination.prev=null!==i.prev_page_url,t.cars.forEach(function(e){null!==e.distance&&t.carsLocations.push([e.lat,e.long])}),console.log(t.carsLocations),u(),t.carsCollectionCtrl.loading.retrieve=!1,t.carsCollectionCtrl.last_page<t.carsCollectionCtrl.current_page&&(t.carsCollectionCtrl.current_page=t.carsCollectionCtrl.last_page,o.search("page",t.carsCollectionCtrl.last_page),t.retrieve()),t.digest()},function(e){console.log(e);e.data;t.carsCollectionCtrl.error.retrieve=!0,t.carsCollectionCtrl.error.message.retrieve=["Error fetching cars"],t.carsCollectionCtrl.loading.retrieve=!1,t.digest()})};var c=function(){var i="",n=0;return t.carsCollectionCtrl.current_page>1&&(i+="page="+t.carsCollectionCtrl.current_page,n++),null!==e.metadata.current_location&&(n>0&&(i+="&"),i+="lat="+e.metadata.current_location.latitude,i+="&",i+="long="+e.metadata.current_location.longitude,n++),i}}]);
//# sourceMappingURL=../js/ng-min.js.map
